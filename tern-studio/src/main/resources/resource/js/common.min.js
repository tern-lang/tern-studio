define(["require","exports","jquery","w2ui"],function(x,n,q,v){(function(c){function n(a,b){return b&&0<b.length?w(a,b[0].field,b[0].direction):a}function w(a,b,d){for(var g=[],e={},f=!0,h=0;h<a.length;h++){var l=a[h];if(l){var c=l[b];"string"==typeof c&&(c=c.toLowerCase());"number"!=typeof c&&(f=!1);var k=e[c];null==k&&(k=[],e[c]=k);k.push(l)}}a=[];for(var m in e)e.hasOwnProperty(m)&&(f?a.push(parseFloat(m)):a.push(m));f?a.sort(function(a,b){return a-b}):a.sort();"asc"!=d&&a.reverse();for(h=0;h<
a.length;h++)for(c=a[h],k=e[c],d=0;d<k.length;d++)l=k[d],g.push(l);return g}function r(a,b){return function(d){var c=a;a=null;c&&(b?setTimeout(function(){c(d)},b):c(d))}}function t(a,b,d){return a&&b&&d?a.split(b).join(d):a}function u(){return(new Date).getTime()}c.openDialog=function(a,b,d,c){var e=u();a=window.open(a,b+e,"height\x3d"+c+",width\x3d"+d);void 0!=a&&a.focus&&(a.resizeTo(d,c),a.focus());return!1};c.getProjectName=function(){var a=document.title;if(a){var a=a.trim(),b=a.lastIndexOf(" ");
return-1!=b&&b!=a.length?a.substring(b+1,a.length):a}return""};c.extractParameter=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=(new RegExp("[\\?\x26]"+a+"\x3d([^\x26#]*)")).exec(window.location.href);return null==a?"":a[1]};c.decodeValue=function(a){if(0<a.length){var b=("@"+a).substring(2);if("\x3c"==a.charAt(0)){a=b.toString();for(var b="",d=0;d<a.length;d+=2)var c=a.substr(d,2),c=parseInt(c,16),b=b+String.fromCharCode(c)}return b}return null};c.updateTableRecords=function(a,b){var d=
v.w2ui[b];if(d){var c=q("#grid_"+b+"_records").prop("scrollTop"),e=d.records,f=d.sortData,h=!1;if(a.length==e.length){for(var l=0;l<a.length;l++){var p=e[l],k=a[l];if(!p||p.length!=k.length){h=!0;break}for(var m in p)if(p.hasOwnProperty(m)){if(!k.hasOwnProperty(m)){h=!0;break}if(p[m]!=k[m]){h=!0;break}}}h&&(d.records=n(a,f),d.refresh())}else d.records=n(a,f),d.refresh(),h=!0;a.length>e.length&&(d.reload(),q("#grid_"+b+"_records").prop("scrollTop",c));return h}return!1};c.createOneTimeFunction=r;c.createSimpleStateMachineFunction=
function(a,b,d,c){var e=r(b,c),f=[];return function(b){if(0<d.length){var c;c=d.indexOf(b);-1<c?(d.splice(c,1),c=!0):c=!1;c?(c=f.indexOf(b),-1==c&&f.push(b),console.log("["+a+"] Received event '"+b+"' "+d.length+" remain")):(c=f.indexOf(b),-1==c&&console.warn("["+a+"] Ignoring unknown event '"+b+"' "+d.length+" remain"));0>=d.length&&e()}}};c.getElementsByClassName=function(a,b){function c(a){for(var d=0;d<a.childNodes.length;d++)0<a.childNodes[d].childNodes.length&&c(a.childNodes[d]),a.childNodes[d].getAttribute&&
a.childNodes[d].getAttribute("class")&&0<=a.childNodes[d].getAttribute("class").split(" ").indexOf(b)&&g.push(a.childNodes[d])}var g=[];c(a);return g};c.isChildElementVisible=function(a,b){var c=b.getBoundingClientRect(),g=a.getBoundingClientRect(),e=c.top+c.height,f=g.top+a.clientHeight;return c.top>g.top&&e<f};c.calculateScrollOffset=function(a,c){var b=c.getBoundingClientRect(),g=a.getBoundingClientRect(),e=b.top,f=g.top;if(e<f)return e-f;b=b.top+b.height;g=g.top+a.clientHeight;return b>g?b-g:
0};c.formatTimeMillis=function(a){a=(new Date(a)).toISOString();var b=a.indexOf(".");a=a.substring(0,b);return t(a,"T"," ")};c.stringReplaceText=t;c.stringContains=function(a,b){return a&&b?-1!==a.indexOf(b):!1};c.stringEndsWith=function(a,b){return a&&b&&a.length>=b.length?a.slice(-b.length)==b:!1};c.stringStartsWith=function(a,b){return a&&b&&a.length>=b.length?a.substring(0,b.length)===b:!1};c.isMacintosh=function(){return-1<navigator.platform.indexOf("Mac")};c.isWindows=function(){return-1<navigator.platform.indexOf("Win")};
c.escapeHtml=function(a){return a.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;").replace(/'/g,"\x26#039;")};c.clearHtml=function(a){return a.replace(/<br>/g,"").replace(/&quot;/g,'"').replace(/&lt;/g,"\x3c").replace(/&gt;/g,"\x3e").replace(/&nbsp;/g," ").replace(/&amp;/g,"\x26")};c.currentTime=u})(n.Common||(n.Common={}))});
