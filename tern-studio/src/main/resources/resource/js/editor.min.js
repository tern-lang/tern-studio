define("require exports jquery ace w2ui common socket problem tree history project status keys commands".split(" "),function(O,h,t,n,A,f,I,J,q,K,u,L,M,v){var D=function(){function a(b){this._editorBreakpointManager=new B(this);this._editorHighlightManager=new C(this);this._editorPanel=b;this._editorHistory={};this._editorMarkers={};this._editorBreakpoints={}}a.prototype.activateEditor=function(){M.KeyBinder.bindKeys();u.Project.changeProjectFont();r.scrollEditorToPosition();r.updateProjectTabOnChange()};
a.prototype.updateResourcePath=function(b,a){window.location.hash=b.getProjectPath();this._editorResource=b;this._editorReadOnly=a};a.prototype.getHistoryForResource=function(b){if(b){b=b.getResourcePath();var a=this._editorHistory[b];a||(a=this._editorHistory[b]=new w(-1,null,null,null,null));return a}return new w(-1,null,null,null,null)};a.prototype.getEditorBreakpointManager=function(){return this._editorBreakpointManager};a.prototype.getEditorHighlightManager=function(){return this._editorHighlightManager};
a.prototype.getEditorResource=function(){return this._editorResource};a.prototype.isEditorReadOnly=function(){return this._editorReadOnly};a.prototype.getEditorPanel=function(){return this._editorPanel};a.prototype.getEditorMarkers=function(){return this._editorMarkers};a.prototype.getEditorBreakpoints=function(){return this._editorBreakpoints};return a}();h.FileEditorView=D;var B=function(){function a(b){this._editorView=b}a.prototype.getEditorView=function(){return this._editorView};a.prototype.clearEditorBreakpoint=
function(b){var a=this.getEditorView().getEditorPanel().getSession(),c=a.getBreakpoints();b=parseInt(b);for(var k in c)if(c.hasOwnProperty(k)){var e=parseInt(k);e==b&&a.clearBreakpoint(e)}this.showEditorBreakpoints()};a.prototype.clearEditorBreakpoints=function(){var b=this.getEditorView().getEditorPanel().getSession(),a=b.getBreakpoints(),c;for(c in a)a.hasOwnProperty(c)&&b.clearBreakpoint(c)};a.prototype.showEditorBreakpoints=function(){var b=this.getEditorView().getEditorBreakpoints(),a=[],c=1,
k;for(k in b)if(b.hasOwnProperty(k)){var e=b[k],l;for(l in e)if(e.hasOwnProperty(l)&&1==e[l]){var f=q.FileTree.createResourcePath(k),m="\x3cdiv class\x3d'breakpointEnabled'\x3e"+f.getProjectPath()+"\x3c/div\x3e";a.push({recid:c++,name:m,location:"Line "+l,resource:f.getProjectPath(),line:parseInt(l),script:f.getResourcePath()})}}A.w2ui.breakpoints.records=a;A.w2ui.breakpoints.refresh();v.Command.updateScriptBreakpoints()};a.prototype.setEditorBreakpoint=function(a,d){var b=this.getEditorView().getEditorBreakpoints(),
k=parseInt(a);if(null!=this.getEditorView().getEditorResource()){var e=this.getEditorView().getEditorPanel().getSession(),l=b[this.getEditorView().getEditorResource().getFilePath()];d?e.setBreakpoint(k):e.clearBreakpoint(k);null==l&&(l={},b[this.getEditorView().getEditorResource().getFilePath()]=l);l[k+1]=d}this.showEditorBreakpoints()};a.prototype.toggleEditorBreakpoint=function(a){var b=this.getEditorView().getEditorBreakpoints();if(null!=this.getEditorView().getEditorResource()){var c=this.getEditorView().getEditorPanel().getSession(),
k=c.getBreakpoints(),e=b[this.getEditorView().getEditorResource().getFilePath()],l=!1,f;for(f in k)if(f==a){l=!0;break}l?c.clearBreakpoint(a):c.setBreakpoint(a);a=parseInt(a);null==e?(e={},e[a+1]=!0,b[this.getEditorView().getEditorResource().getFilePath()]=e):e[a+1]=1==e[a+1]?!1:!0}this.showEditorBreakpoints()};a.prototype.restoreResourceBreakpoints=function(){var a=this.getEditorView();if(a.getEditorResource()){var d=a.getEditorResource().getFilePath(),a=a.getEditorBreakpoints()[d];if(null!=a)for(var c in a)a.hasOwnProperty(c)&&
1==a[c]&&this.setEditorBreakpoint(parseInt(c)-1,!0)}};return a}();h.FileEditorBreakpointManager=B;var C=function(){function a(a){this._editorView=a}a.prototype.getEditorView=function(){return this._editorView};a.prototype.clearEditorHighlights=function(){var a=this.getEditorView().getEditorPanel().getSession(),d=this.getEditorView().getEditorMarkers();this.getEditorView().getEditorResource();for(var c in d)if(d.hasOwnProperty(c)){var k=d[c];null!=k&&(a.removeMarker(k.getMarker()),delete d[c])}};a.prototype.showEditorLine=
function(a){this.getEditorView().getEditorPanel();this.getEditorView().getEditorPanel().resize(!0);if(1<a){var b=a-1;this.getCurrentLineForEditor()!=b&&(this.getEditorView().getEditorPanel().scrollToLine(b,!0,!0,function(){}),this.getEditorView().getEditorPanel().gotoLine(a),this.getEditorView().getEditorPanel().focus())}else this.getEditorView().getEditorPanel().scrollToLine(0,!0,!0,function(){}),this.getEditorView().getEditorPanel().focus()};a.prototype.clearEditorHighlight=function(a){var b=this.getEditorView().getEditorPanel().getSession();
a=this.getEditorView().getEditorMarkers()[a];null!=a&&b.removeMarker(a.getMarker())};a.prototype.createEditorHighlight=function(a,d){var b=n.ace.require("ace/range").Range,k=this.getEditorView().getEditorPanel().getSession(),e=this.getEditorView().getEditorMarkers(),l=e[a];this.clearEditorHighlights();b=k.addMarker(new b(a-1,0,a-1,1),d,"fullLine");b=new x(a,d,b);e[a]=b;return l?l.getStyle()!=d:!1};a.prototype.createMultipleEditorHighlights=function(a,d){for(var b=n.ace.require("ace/range").Range,
k=this.getEditorView().getEditorPanel().getSession(),e=this.getEditorView().getEditorMarkers(),l=!1,f=0;f<a.length;f++){var m=a[f];(m=e[m])?m.getStyle()!=d&&(l=!0):l=!0}this.clearEditorHighlights();for(f=0;f<a.length;f++){var m=a[f],h=k.addMarker(new b(m-1,0,m-1,1),d,"fullLine"),h=new x(m,d,h);e[m]=h}return l};a.prototype.getCurrentLineForEditor=function(){return this.getEditorView().getEditorPanel().getSelectionRange().start.row};return a}();h.FileEditorHighlightManager=C;var x=function(){function a(a,
d,c){this._style=d;this._line=a;this._marker=c}a.prototype.getLine=function(){return this._line};a.prototype.getMarker=function(){return this._marker};a.prototype.getStyle=function(){return this._style};return a}();h.FileEditorMarker=x;var w=function(){function a(a,d,c,k,e){this._lastModified=a;this._undoState=d;this._position=c;this._originalText=e;this._savedText=k;this._changeMade=!1}a.prototype.restoreUndoManager=function(a,d){var b=new n.ace.UndoManager;if(d==this._savedText&&this._undoState){var k=
this._undoState.getUndoStack(),e=this._undoState.getRedoStack(),f;for(f in k)k.hasOwnProperty(f)&&(b.$undoStack[f]=k[f]);for(var h in e)e.hasOwnProperty(h)&&(b.$redoStack[h]=k[h]);b.$doc=a;b.dirtyCounter=this._undoState.getDirtyCounter()}a.setUndoManager(b)};a.prototype.restoreScrollPosition=function(a,d){if(this._position){var b=this._position.getScroll(),k=this._position.getRow(),e=this._position.getColumn();0<=k&&0<=e?d.selection.moveTo(k,e):d.gotoLine(1);a.setScrollTop(b)}else d.gotoLine(1),a.setScrollTop(0);
d.focus()};a.prototype.saveHistory=function(a){a.getSource();this._savedText=a.getSource();this._lastModified=a.getLastModified();this._undoState=a.getUndoState();this._position=a.getPosition()};a.prototype.updateHistory=function(a,d){a!=this._savedText&&(this._position=this._undoState=null);this._savedText=a;this._originalText=d;this._changeMade=!1};a.prototype.invalidateHistory=function(){this._changeMade=!1;this._undoState=null;this._lastModified=-1;this._savedText=this._originalText=null};a.prototype.touchHistory=
function(a){a!=this._savedText&&(this._lastModified=f.Common.currentTime());this._savedText=a};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getOriginalText=function(){return this._originalText};a.prototype.getSavedText=function(){return this._savedText};return a}();h.FileEditorHistory=w;var E=function(){function a(a,d,c){this._undoStack=a;this._redoStack=d;this._dirtyCounter=c}a.prototype.getUndoStack=function(){return this._undoStack};a.prototype.getRedoStack=function(){return this._redoStack};
a.prototype.getDirtyCounter=function(){return this._dirtyCounter};return a}();h.FileEditorUndoState=E;var F=function(){function a(a,d,c,k,e,f,h){this._lastModified=a;this._breakpoints=d;this._resource=c;this._undoState=k;this._isReadOnly=h;this._position=e;this._source=f}a.prototype.isStateValid=function(){return this._resource&&null!=this._source&&""!=this._source};a.prototype.isReadOnly=function(){return this._isReadOnly};a.prototype.getResource=function(){return this._resource};a.prototype.getPosition=
function(){return this._position};a.prototype.getUndoState=function(){return this._undoState};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getBreakpoints=function(){return this._breakpoints};a.prototype.getSource=function(){return this._source};return a}();h.FileEditorState=F;var y=function(){function a(a,d,c){this._row=a;this._column=d;this._scroll=c}a.prototype.getRow=function(){return this._row};a.prototype.getColumn=function(){return this._column};a.prototype.getScroll=
function(){return this._scroll};return a}();h.FileEditorPosition=y;var z=function(){function a(a,d,c,f){this._lastModified=a;this._isCurrent=f;this._resource=d;this._source=c}a.prototype.isBufferValid=function(){return this._resource&&null!=this._source};a.prototype.isBufferCurrent=function(){return this._isCurrent};a.prototype.getResource=function(){return this._resource};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getSource=function(){return this._source};return a}();
h.FileEditorBuffer=z;var N=function(){function a(a,f,c,k,e,l){this._editorView=a;this._resourcePath=f;this._editorMode=c;this._editorText=k;this._isReadOnly=e;this._lastModified=l}a.prototype.isReadOnly=function(){return this._isReadOnly};a.prototype.getEditorView=function(){return this._editorView};a.prototype.getResourcePath=function(){return this._resourcePath};a.prototype.getEditorMode=function(){return this._editorMode};a.prototype.getEditorText=function(){return this._editorText};a.prototype.getLastModified=
function(){return this._lastModified};return a}(),G;(function(a){function b(a){return{getCompletions:function(b,d,e,l,h){d=b.getValue();var c=b.session.getLine(e.row);b=a.getEditorResource().getProjectPath();c=c.substring(0,e.column);e=JSON.stringify({resource:b,line:e.row+1,complete:c,source:d,prefix:l});t.ajax({contentType:"application/json",data:e,dataType:"json",success:function(a){var b=a.expression;if(b){var p=Math.max(0,b.lastIndexOf(".")+1);a=a.tokens;var c=[],d;for(d in a)if(a.hasOwnProperty(d)){var e=
a[d];f.Common.stringStartsWith(d,b)&&(d=d.substring(p));c.push({className:"autocomplete_"+e,token:d,value:d,score:300,meta:e})}h(null,c)}},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+f.Common.getProjectName()})}}}a.createFileEditorView=function(a){var c=n.ace.edit(a),d=new D(c);a=b(d);c.completers=[a];c.getSession().setMode("ace/mode/tern");c.getSession().setTabSize(3);c.setReadOnly(!1);c.setAutoScrollEditorIntoView(!0);c.getSession().setUseSoftTabs(!0);
c.commands.removeCommand("replace");c.commands.removeCommand("find");c.commands.removeCommand("expandToMatching");c.commands.removeCommand("expandtoline");c.setShowPrintMargin(!1);c.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0});c.on("guttermousedown",function(a){var b=a.domEvent.target;-1==b.className.indexOf("ace_gutter-cell")||!c.isFocused()||a.clientX>25+b.getBoundingClientRect().left||(b=a.getDocumentPosition().row,d.getEditorBreakpointManager().toggleEditorBreakpoint(b),
a.stop())});"undefined"!==typeof java&&c.setScrollSpeed(.05);return d}})(G=h.FileEditorBuilder||(h.FileEditorBuilder={}));var H;(function(a){a.resolveEditorMode=function(a){a=a.toLowerCase();if(f.Common.stringEndsWith(a,".tern"))return"ace/mode/tern";if(f.Common.stringEndsWith(a,".policy"))return"ace/mode/policy";if(f.Common.stringEndsWith(a,".xml"))return"ace/mode/xml";if(f.Common.stringEndsWith(a,".json"))return"ace/mode/json";if(f.Common.stringEndsWith(a,".sql"))return"ace/mode/sql";if(f.Common.stringEndsWith(a,
".pl"))return"ace/mode/perl";if(f.Common.stringEndsWith(a,".kt"))return"ace/mode/kotlin";if(f.Common.stringEndsWith(a,".js"))return"ace/mode/javascript";if(f.Common.stringEndsWith(a,".ts"))return"ace/mode/typescript";if(f.Common.stringEndsWith(a,".java"))return"ace/mode/java";if(f.Common.stringEndsWith(a,".groovy"))return"ace/mode/groovy";if(f.Common.stringEndsWith(a,".py"))return"ace/mode/python";if(f.Common.stringEndsWith(a,".html")||f.Common.stringEndsWith(a,".htm"))return"ace/mode/html";if(f.Common.stringEndsWith(a,
".txt"))return"ace/mode/text";if(f.Common.stringEndsWith(a,".properties"))return"ace/mode/properties";if(f.Common.stringEndsWith(a,".gitignore"))return"ace/mode/text";if(f.Common.stringEndsWith(a,".project"))return"ace/mode/xml";f.Common.stringEndsWith(a,".classpath");return"ace/mode/text"}})(H=h.FileEditorModeMapper||(h.FileEditorModeMapper={}));var r;(function(a){function b(){var a;a=g.getEditorPanel().getSession().getUndoManager();var b=t.extend(!0,{},a.$undoStack),c=t.extend(!0,{},a.$redoStack);
a=new E(b,c,a.dirtyCounter);b=g.getEditorPanel().getSession().getScrollTop();b=(c=g.getEditorPanel().selection.getCursor())?new y(c.row,c.column,b):new y(null,null,b);var c=d(),f=-1,e=null;c&&(e=c.getSource(),f=c.getLastModified());return new F(f,g.getEditorBreakpoints(),g.getEditorResource(),a,b,e,g.isEditorReadOnly())}function d(){if(g.getEditorResource()){var a=g.getEditorResource().getResourcePath();return c(a)}return null}function c(a){a=q.FileTree.createResourcePath(a);var b=g.getHistoryForResource(a),
c=b.getLastModified(),p=a.getResourcePath();return n(p)?(b=g.getEditorPanel().getValue(),new z(c,a,b,!0)):new z(c,a,b.getSavedText(),!1)}function k(a){g.getEditorPanel().setReadOnly(a)}function e(){if(null!=g.getEditorResource()){var a=g.getHistoryForResource(g.getEditorResource()),b=g.getEditorPanel().getValue(),a=a.getOriginalText();return b!=a}return!1}function h(a){if(n(a))return e();a=q.FileTree.createResourcePath(a);var b=g.getHistoryForResource(a);a=b.getOriginalText();b=b.getSavedText();return a!=
b}function n(a){return null!=g.getEditorResource()&&g.getEditorResource().getResourcePath()==a?!0:!1}function m(){var a=g.getEditorPanel().getSession();g.getHistoryForResource(g.getEditorResource()).restoreScrollPosition(a,g.getEditorPanel())}function r(a){u.Project.markEditorTab(a,h(a))}var g=null;a.createEditor=function(){g=G.createFileEditorView("editor");g.activateEditor();I.EventBus.createTermination(function(){g.getEditorHighlightManager().clearEditorHighlights()})};a.clearEditorHighlights=
function(){g.getEditorHighlightManager().clearEditorHighlights()};a.showEditorLine=function(a){g.getEditorHighlightManager().showEditorLine(a)};a.clearEditorHighlight=function(a){g.getEditorHighlightManager().clearEditorHighlight(a)};a.createEditorHighlight=function(a,b){return g.getEditorHighlightManager().createEditorHighlight(a,b)};a.createMultipleEditorHighlights=function(a,b){return g.getEditorHighlightManager().createMultipleEditorHighlights(a,b)};a.findAndReplaceTextInEditor=function(){var a=
b().getResource();v.Command.searchAndReplaceFiles(a.getProjectPath())};a.findTextInEditor=function(){var a=b().getResource();v.Command.searchFiles(a.getProjectPath())};a.addEditorKeyBinding=function(a,b){g.getEditorPanel().commands.addCommand({name:a.editor,bindKey:{win:a.editor,mac:a.editor},exec:function(a){b&&b()}})};a.resizeEditor=function(){var a=document.getElementById("editor").offsetWidth,b=document.getElementById("editor").offsetHeight;console.log("Resize editor "+a+"x"+b);g.getEditorPanel().setAutoScrollEditorIntoView(!0);
g.getEditorPanel().resize(!0)};a.currentEditorState=b;a.clearSavedEditorBuffer=function(a){var b=q.FileTree.createResourcePath(a);g.getHistoryForResource(b).invalidateHistory();r(a)};a.currrentEditorBuffer=d;a.getEditorBufferForResource=c;a.updateEditor=function(d){var f;f=d.getFileContent();if(!d.isHistorical()&&!d.isError()){var e=d.getResourcePath().getResourcePath(),h=d.getLastModified(),l=c(e),e=l.getSource(),l=l.getLastModified();e&&l>=h&&(f=e)}var h=d.getResourcePath(),l=h.getResourcePath(),
e=d.isHistorical()||d.isError(),l=H.resolveEditorMode(l),p=d.getLastModified();f=new N(g,h,l,f,e,p);h=b();h.isReadOnly()||(e=h.getResource(),e=g.getHistoryForResource(e),h.isStateValid()?e.saveHistory(h):e.invalidateHistory());var h=g.getEditorPanel().getSession(),e=h.getMode(),l=d.getFileContent(),n=f.getEditorMode(),p=f.getEditorText();d=f.isReadOnly();f=f.getResourcePath();n!=e&&h.setMode({path:n,v:Date.now()});d?(g.getEditorPanel().setReadOnly(!1),g.getEditorPanel().setValue(p,1)):(e=g.getHistoryForResource(f),
g.getEditorPanel().setReadOnly(!1),g.getEditorPanel().setValue(p,1),e.updateHistory(p,l),e.restoreUndoManager(h,p));k(d);var h=g.getEditorPanel().getSession(),q;for(q in h.$backMarkers)h.removeMarker(q);g.getEditorHighlightManager().clearEditorHighlights();g.getEditorBreakpointManager().clearEditorBreakpoints();t("#currentFile").html("");g.updateResourcePath(f,d);J.ProblemManager.highlightProblems();g.getEditorBreakpointManager().restoreResourceBreakpoints();u.Project.createEditorTab();K.History.showFileHistory();
L.StatusPanel.showActiveFile(g.getEditorResource().getProjectPath());a.showEditorFileInTree();m();r(g.getEditorResource().getResourcePath())};a.focusEditor=function(){g.getEditorPanel().focus();g.getEditorPanel().setReadOnly(!1)};a.setReadOnly=k;a.showEditorFileInTree=function(){var a=b().getResource();q.FileTree.showTreeNode("explorerTree",a)};a.getCurrentLineForEditor=function(){return g.getEditorPanel().getSelectionRange().start.row};a.getSelectedText=function(){return g.getEditorPanel().getSelectedText()};
a.isEditorChanged=e;a.isEditorChangedForPath=h;a.scrollEditorToPosition=m;a.updateProjectTabOnChange=function(){g.getEditorPanel().on("input",function(){var a=g.getEditorResource(),a=g.getHistoryForResource(a),b=g.getEditorPanel().getValue();a.touchHistory(b);r(g.getEditorResource().getResourcePath())})};a.formatEditorSource=function(){var a=g.getEditorPanel().getValue(),b=g.getEditorResource().getFilePath();t.ajax({contentType:"text/plain",data:a,success:function(a){g.getEditorPanel().setReadOnly(!1);
g.getEditorPanel().setValue(a,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+f.Common.getProjectName()+b})};a.setEditorTheme=function(a){null!=a&&null!=g.getEditorPanel()&&g.getEditorPanel().setTheme(a)};a.showEditorBreakpoints=function(){g.getEditorBreakpointManager().showEditorBreakpoints()};a.updateEditorFont=function(a,b){var c;c=a.split(",");for(var d="",e=0;e<c.length;e++)var h=c[e],h=f.Common.stringReplaceText(h,"'",""),h=f.Common.stringReplaceText(h,
'"',""),h="'"+h.trim()+"'",d=d+(h+",");c=d+"monospace";g.getEditorPanel().setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,fontFamily:c,fontSize:b})}})(r=h.FileEditor||(h.FileEditor={}))});
