define("require exports jquery ace w2ui common socket problem tree history project status keys commands".split(" "),function(O,l,w,q,B,g,J,K,p,L,x,M,N,v){var E=function(){function a(b){this._editorBreakpointManager=new C(this);this._editorHighlightManager=new D(this);this._editorPanel=b;this._editorHistory={};this._editorMarkers={};this._editorBreakpoints={}}a.prototype.activateEditor=function(){N.KeyBinder.bindKeys();x.Project.changeProjectFont();r.scrollEditorToPosition();r.updateProjectTabOnChange()};
a.prototype.updateResourcePath=function(b,a){window.location.hash=b.getProjectPath();this._editorResource=b;this._editorReadOnly=a};a.prototype.getHistoryForResource=function(b){if(b){b=b.getResourcePath();var a=this._editorHistory[b];a||(a=this._editorHistory[b]=new t(-1,null,null,null,null));return a}return new t(-1,null,null,null,null)};a.prototype.getEditorBreakpointManager=function(){return this._editorBreakpointManager};a.prototype.getEditorHighlightManager=function(){return this._editorHighlightManager};
a.prototype.getEditorResource=function(){return this._editorResource};a.prototype.isEditorReadOnly=function(){return this._editorReadOnly};a.prototype.getEditorPanel=function(){return this._editorPanel};a.prototype.getEditorMarkers=function(){return this._editorMarkers};a.prototype.getEditorBreakpoints=function(){return this._editorBreakpoints};return a}();l.FileEditorView=E;var C=function(){function a(b){this._editorView=b}a.prototype.getEditorView=function(){return this._editorView};a.prototype.clearEditorBreakpoint=
function(b){var a=this.getEditorView().getEditorPanel().getSession(),d=a.getBreakpoints();b=parseInt(b);for(var h in d)if(d.hasOwnProperty(h)){var c=parseInt(h);c==b&&a.clearBreakpoint(c)}this.showEditorBreakpoints()};a.prototype.clearEditorBreakpoints=function(){var b=this.getEditorView().getEditorPanel().getSession(),a=b.getBreakpoints(),d;for(d in a)a.hasOwnProperty(d)&&b.clearBreakpoint(d)};a.prototype.showEditorBreakpoints=function(){var b=this.getEditorView().getEditorBreakpoints(),a=[],d=1,
h;for(h in b)if(b.hasOwnProperty(h)){var c=b[h],k;for(k in c)if(c.hasOwnProperty(k)&&1==c[k]){var m=p.FileTree.createResourcePath(h),g="\x3cdiv class\x3d'breakpointEnabled'\x3e"+m.getProjectPath()+"\x3c/div\x3e";a.push({recid:d++,name:g,location:"Line "+k,resource:m.getProjectPath(),line:parseInt(k),script:m.getResourcePath()})}}B.w2ui.breakpoints.records=a;B.w2ui.breakpoints.refresh();v.Command.updateScriptBreakpoints()};a.prototype.setEditorBreakpoint=function(a,f){var b=this.getEditorView().getEditorBreakpoints(),
h=parseInt(a);if(null!=this.getEditorView().getEditorResource()){var c=this.getEditorView().getEditorPanel().getSession(),k=b[this.getEditorView().getEditorResource().getFilePath()];f?c.setBreakpoint(h):c.clearBreakpoint(h);null==k&&(k={},b[this.getEditorView().getEditorResource().getFilePath()]=k);k[h+1]=f}this.showEditorBreakpoints()};a.prototype.toggleEditorBreakpoint=function(a){var b=this.getEditorView().getEditorBreakpoints();if(null!=this.getEditorView().getEditorResource()){var d=this.getEditorView().getEditorPanel().getSession(),
h=d.getBreakpoints(),c=b[this.getEditorView().getEditorResource().getFilePath()],k=!1,m;for(m in h)if(m==a){k=!0;break}k?d.clearBreakpoint(a):d.setBreakpoint(a);a=parseInt(a);null==c?(c={},c[a+1]=!0,b[this.getEditorView().getEditorResource().getFilePath()]=c):c[a+1]=1==c[a+1]?!1:!0}this.showEditorBreakpoints()};return a}();l.FileEditorBreakpointManager=C;var D=function(){function a(a){this._editorView=a}a.prototype.getEditorView=function(){return this._editorView};a.prototype.clearEditorHighlights=
function(){var a=this.getEditorView().getEditorPanel().getSession(),f=this.getEditorView().getEditorMarkers();this.getEditorView().getEditorResource();for(var d in f)if(f.hasOwnProperty(d)){var h=f[d];null!=h&&(a.removeMarker(h.getMarker()),delete f[d])}};a.prototype.showEditorLine=function(a){this.getEditorView().getEditorPanel();this.getEditorView().getEditorPanel().resize(!0);if(1<a){var b=a-1;this.getCurrentLineForEditor()!=b&&(this.getEditorView().getEditorPanel().scrollToLine(b,!0,!0,function(){}),
this.getEditorView().getEditorPanel().gotoLine(a),this.getEditorView().getEditorPanel().focus())}else this.getEditorView().getEditorPanel().scrollToLine(0,!0,!0,function(){}),this.getEditorView().getEditorPanel().focus()};a.prototype.clearEditorHighlight=function(a){var b=this.getEditorView().getEditorPanel().getSession();a=this.getEditorView().getEditorMarkers()[a];null!=a&&b.removeMarker(a.getMarker())};a.prototype.createEditorHighlight=function(a,f){var b=q.ace.require("ace/range").Range,h=this.getEditorView().getEditorPanel().getSession(),
c=this.getEditorView().getEditorMarkers(),k=c[a];this.clearEditorHighlights();b=h.addMarker(new b(a-1,0,a-1,1),f,"fullLine");b=new y(a,f,b);c[a]=b;return k?k.getStyle()!=f:!1};a.prototype.createMultipleEditorHighlights=function(a,f){for(var b=q.ace.require("ace/range").Range,h=this.getEditorView().getEditorPanel().getSession(),c=this.getEditorView().getEditorMarkers(),k=!1,m=0;m<a.length;m++){var g=a[m];(g=c[g])?g.getStyle()!=f&&(k=!0):k=!0}this.clearEditorHighlights();for(m=0;m<a.length;m++){var g=
a[m],l=h.addMarker(new b(g-1,0,g-1,1),f,"fullLine"),l=new y(g,f,l);c[g]=l}return k};a.prototype.getCurrentLineForEditor=function(){return this.getEditorView().getEditorPanel().getSelectionRange().start.row};return a}();l.FileEditorHighlightManager=D;var y=function(){function a(a,f,d){this._style=f;this._line=a;this._marker=d}a.prototype.getLine=function(){return this._line};a.prototype.getMarker=function(){return this._marker};a.prototype.getStyle=function(){return this._style};return a}();l.FileEditorMarker=
y;var t=function(){function a(a,f,d,h,c){this._lastModified=a;this._undoState=f;this._position=d;this._originalText=c;this._savedText=h;this._changeMade=!1}a.prototype.restoreUndoManager=function(a,f){var b=new q.ace.UndoManager;if(f==this._savedText&&this._undoState){var h=this._undoState.getUndoStack(),c=this._undoState.getRedoStack(),k;for(k in h)h.hasOwnProperty(k)&&(b.$undoStack[k]=h[k]);for(var g in c)c.hasOwnProperty(g)&&(b.$redoStack[g]=h[g]);b.$doc=a;b.dirtyCounter=this._undoState.getDirtyCounter()}a.setUndoManager(b)};
a.prototype.restoreScrollPosition=function(a,f){if(this._position){var b=this._position.getScroll(),h=this._position.getRow(),c=this._position.getColumn();0<=h&&0<=c?f.selection.moveTo(h,c):f.gotoLine(1);a.setScrollTop(b)}else f.gotoLine(1),a.setScrollTop(0);f.focus()};a.prototype.saveHistory=function(a){a.getSource();this._savedText=a.getSource();this._lastModified=a.getLastModified();this._undoState=a.getUndoState();this._position=a.getPosition()};a.prototype.updateHistory=function(a,f){a!=this._savedText&&
(this._position=this._undoState=null);this._savedText=a;this._originalText=f;this._changeMade=!1};a.prototype.invalidateHistory=function(){this._changeMade=!1;this._undoState=null;this._lastModified=-1;this._savedText=this._originalText=null};a.prototype.touchHistory=function(a){a!=this._savedText&&(this._lastModified=g.Common.currentTime());this._savedText=a};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getOriginalText=function(){return this._originalText};a.prototype.getSavedText=
function(){return this._savedText};return a}();l.FileEditorHistory=t;var F=function(){function a(a,f,d){this._undoStack=a;this._redoStack=f;this._dirtyCounter=d}a.prototype.getUndoStack=function(){return this._undoStack};a.prototype.getRedoStack=function(){return this._redoStack};a.prototype.getDirtyCounter=function(){return this._dirtyCounter};return a}();l.FileEditorUndoState=F;var G=function(){function a(a,f,d,h,c,k,g){this._lastModified=a;this._breakpoints=f;this._resource=d;this._undoState=h;
this._isReadOnly=g;this._position=c;this._source=k}a.prototype.isStateValid=function(){return this._resource&&null!=this._source&&""!=this._source};a.prototype.isReadOnly=function(){return this._isReadOnly};a.prototype.getResource=function(){return this._resource};a.prototype.getPosition=function(){return this._position};a.prototype.getUndoState=function(){return this._undoState};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getBreakpoints=function(){return this._breakpoints};
a.prototype.getSource=function(){return this._source};return a}();l.FileEditorState=G;var z=function(){function a(a,f,d){this._row=a;this._column=f;this._scroll=d}a.prototype.getRow=function(){return this._row};a.prototype.getColumn=function(){return this._column};a.prototype.getScroll=function(){return this._scroll};return a}();l.FileEditorPosition=z;var A=function(){function a(a,f,d,h){this._lastModified=a;this._isCurrent=h;this._resource=f;this._source=d}a.prototype.isBufferValid=function(){return this._resource&&
null!=this._source};a.prototype.isBufferCurrent=function(){return this._isCurrent};a.prototype.getResource=function(){return this._resource};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getSource=function(){return this._source};return a}();l.FileEditorBuffer=A;var H;(function(a){function b(a){return{getCompletions:function(b,h,c,f,m){h=b.getValue();var d=b.session.getLine(c.row);b=a.getEditorResource().getProjectPath();d=d.substring(0,c.column);c=JSON.stringify({resource:b,
line:c.row+1,complete:d,source:h,prefix:f});w.ajax({contentType:"application/json",data:c,dataType:"json",success:function(a){var b=a.expression;if(b){var u=Math.max(0,b.lastIndexOf(".")+1);a=a.tokens;var d=[],c;for(c in a)if(a.hasOwnProperty(c)){var f=a[c];g.Common.stringStartsWith(c,b)&&(c=c.substring(u));d.push({className:"autocomplete_"+f,token:c,value:c,score:300,meta:f})}m(null,d)}},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+g.Common.getProjectName()})}}}
a.createFileEditorView=function(a){var d=q.ace.edit(a),f=new E(d);a=b(f);d.completers=[a];d.getSession().setMode("ace/mode/tern");d.getSession().setTabSize(3);d.setReadOnly(!1);d.setAutoScrollEditorIntoView(!0);d.getSession().setUseSoftTabs(!0);d.commands.removeCommand("replace");d.commands.removeCommand("find");d.commands.removeCommand("expandToMatching");d.commands.removeCommand("expandtoline");d.setShowPrintMargin(!1);d.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0});d.on("click",
function(a){a=d.getOptions();var b={};console.log("Focus editor on click: options\x3d["+typeof a+"] -\x3e ",a);d.focus();for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);b.readOnly=!1;console.log("Update after click: ",b);d.setOptions(b);d.setReadOnly(!1)});d.on("guttermousedown",function(a){var b=a.domEvent.target;-1==b.className.indexOf("ace_gutter-cell")||!d.isFocused()||a.clientX>25+b.getBoundingClientRect().left||(b=a.getDocumentPosition().row,f.getEditorBreakpointManager().toggleEditorBreakpoint(b),
a.stop())});"undefined"!==typeof java&&d.setScrollSpeed(.05);return f}})(H=l.FileEditorBuilder||(l.FileEditorBuilder={}));var I;(function(a){a.resolveEditorMode=function(a){a=a.toLowerCase();if(g.Common.stringEndsWith(a,".tern"))return"ace/mode/tern";if(g.Common.stringEndsWith(a,".policy"))return"ace/mode/policy";if(g.Common.stringEndsWith(a,".xml"))return"ace/mode/xml";if(g.Common.stringEndsWith(a,".json"))return"ace/mode/json";if(g.Common.stringEndsWith(a,".sql"))return"ace/mode/sql";if(g.Common.stringEndsWith(a,
".pl"))return"ace/mode/perl";if(g.Common.stringEndsWith(a,".kt"))return"ace/mode/kotlin";if(g.Common.stringEndsWith(a,".js"))return"ace/mode/javascript";if(g.Common.stringEndsWith(a,".ts"))return"ace/mode/typescript";if(g.Common.stringEndsWith(a,".java"))return"ace/mode/java";if(g.Common.stringEndsWith(a,".groovy"))return"ace/mode/groovy";if(g.Common.stringEndsWith(a,".py"))return"ace/mode/python";if(g.Common.stringEndsWith(a,".html")||g.Common.stringEndsWith(a,".htm"))return"ace/mode/html";if(g.Common.stringEndsWith(a,
".txt"))return"ace/mode/text";if(g.Common.stringEndsWith(a,".properties"))return"ace/mode/properties";if(g.Common.stringEndsWith(a,".gitignore"))return"ace/mode/text";if(g.Common.stringEndsWith(a,".project"))return"ace/mode/xml";g.Common.stringEndsWith(a,".classpath");return"ace/mode/text"}})(I=l.FileEditorModeMapper||(l.FileEditorModeMapper={}));var r;(function(a){function b(){var a;a=e.getEditorPanel().getSession().getUndoManager();var b=w.extend(!0,{},a.$undoStack),d=w.extend(!0,{},a.$redoStack);
a=new F(b,d,a.dirtyCounter);b=e.getEditorPanel().getSession().getScrollTop();b=(d=e.getEditorPanel().selection.getCursor())?new z(d.row,d.column,b):new z(null,null,b);var d=f(),c=-1,g=null;d&&(g=d.getSource(),c=d.getLastModified());return new G(c,e.getEditorBreakpoints(),e.getEditorResource(),a,b,g,e.isEditorReadOnly())}function f(){if(e.getEditorResource()){var a=e.getEditorResource().getResourcePath();return d(a)}return null}function d(a){a=p.FileTree.createResourcePath(a);var b=e.getHistoryForResource(a),
u=b.getLastModified();return l(a.getResourcePath())?(b=e.getEditorPanel().getValue(),new A(u,a,b,!0)):new A(u,a,b.getSavedText(),!1)}function h(a){e.getEditorPanel().setReadOnly(a)}function c(){if(null!=e.getEditorResource()){var a=e.getHistoryForResource(e.getEditorResource()),b=e.getEditorPanel().getValue(),a=a.getOriginalText();return b!=a}return!1}function k(a){if(l(a))return c();a=p.FileTree.createResourcePath(a);var b=e.getHistoryForResource(a);a=b.getOriginalText();b=b.getSavedText();return a!=
b}function l(a){return null!=e.getEditorResource()&&e.getEditorResource().getResourcePath()==a?!0:!1}function q(){var a=e.getEditorPanel().getSession();e.getHistoryForResource(e.getEditorResource()).restoreScrollPosition(a,e.getEditorPanel())}function r(a){x.Project.markEditorTab(a,k(a))}var e=null;a.createEditor=function(){e=H.createFileEditorView("editor");e.activateEditor();J.EventBus.createTermination(function(){e.getEditorHighlightManager().clearEditorHighlights()})};a.clearEditorHighlights=
function(){e.getEditorHighlightManager().clearEditorHighlights()};a.showEditorLine=function(a){e.getEditorHighlightManager().showEditorLine(a)};a.clearEditorHighlight=function(a){e.getEditorHighlightManager().clearEditorHighlight(a)};a.createEditorHighlight=function(a,b){return e.getEditorHighlightManager().createEditorHighlight(a,b)};a.createMultipleEditorHighlights=function(a,b){return e.getEditorHighlightManager().createMultipleEditorHighlights(a,b)};a.findAndReplaceTextInEditor=function(){var a=
b().getResource();v.Command.searchAndReplaceFiles(a.getProjectPath())};a.findTextInEditor=function(){var a=b().getResource();v.Command.searchFiles(a.getProjectPath())};a.addEditorKeyBinding=function(a,b){e.getEditorPanel().commands.addCommand({name:a.editor,bindKey:{win:a.editor,mac:a.editor},exec:function(a){b&&b()}})};a.resizeEditor=function(){var a=document.getElementById("editor").offsetWidth,b=document.getElementById("editor").offsetHeight;console.log("Resize editor "+a+"x"+b);e.getEditorPanel().setAutoScrollEditorIntoView(!0);
e.getEditorPanel().resize(!0)};a.currentEditorState=b;a.clearSavedEditorBuffer=function(a){var b=p.FileTree.createResourcePath(a);e.getHistoryForResource(b).invalidateHistory();r(a)};a.currrentEditorBuffer=f;a.getEditorBufferForResource=d;a.updateEditor=function(c){var f=c.getResourcePath(),g=c.isHistorical()||c.isError(),k=c.getFileContent(),l;l=c.getFileContent();var n=c.isHistorical()||c.isError();console.log("resource\x3d["+c.getResourcePath().getResourcePath()+"] modified\x3d["+c.getTimeStamp()+
"] length\x3d["+c.getFileLength()+"] readonly\x3d["+n+"]");n?console.log("IGNORE HISTORY WHEN READ ONLY"):(n=d(c.getResourcePath().getResourcePath()),n.getSource()&&n.getLastModified()>c.getLastModified()?(console.log("LOAD FROM HISTORY diff\x3d["+(n.getLastModified()-c.getLastModified())+"]"),l=n.getSource()):console.log("IGNORE HISTORY: ",n));c=e.getEditorPanel().getSession();var n=c.getMode(),u=I.resolveEditorMode(f.getResourcePath()),m=b();if(!m.isReadOnly()){var p=m.getResource(),p=e.getHistoryForResource(p);
m.isStateValid()?p.saveHistory(m):p.invalidateHistory()}u!=n&&c.setMode({path:u,v:Date.now()});g?(k=l,e.getEditorPanel().setReadOnly(!1),e.getEditorPanel().setValue(k,1)):(n=e.getHistoryForResource(f),e.getEditorPanel().setReadOnly(!1),e.getEditorPanel().setValue(l,1),n.updateHistory(l,k),n.restoreUndoManager(c,l));var k=e.getEditorPanel().getSession(),v;for(v in k.$backMarkers)k.removeMarker(v);e.getEditorHighlightManager().clearEditorHighlights();e.getEditorBreakpointManager().clearEditorBreakpoints();
w("#currentFile").html("");h(g);e.updateResourcePath(f,g);K.ProblemManager.highlightProblems();if(null!=f&&e.getEditorResource()&&(f=e.getEditorResource().getFilePath(),f=e.getEditorBreakpoints()[f],null!=f))for(var t in f)f.hasOwnProperty(t)&&1==f[t]&&e.getEditorBreakpointManager().setEditorBreakpoint(parseInt(t)-1,!0);x.Project.createEditorTab();L.History.showFileHistory();M.StatusPanel.showActiveFile(e.getEditorResource().getProjectPath());a.showEditorFileInTree();q();r(e.getEditorResource().getResourcePath())};
a.focusEditor=function(){e.getEditorPanel().focus();e.getEditorPanel().setReadOnly(!1)};a.setReadOnly=h;a.showEditorFileInTree=function(){var a=b().getResource();p.FileTree.showTreeNode("explorerTree",a)};a.getCurrentLineForEditor=function(){return e.getEditorPanel().getSelectionRange().start.row};a.getSelectedText=function(){return e.getEditorPanel().getSelectedText()};a.isEditorChanged=c;a.isEditorChangedForPath=k;a.scrollEditorToPosition=q;a.updateProjectTabOnChange=function(){e.getEditorPanel().on("input",
function(){var a=e.getEditorResource(),a=e.getHistoryForResource(a),b=e.getEditorPanel().getValue();a.touchHistory(b);r(e.getEditorResource().getResourcePath())})};a.formatEditorSource=function(){var a=e.getEditorPanel().getValue(),b=e.getEditorResource().getFilePath();w.ajax({contentType:"text/plain",data:a,success:function(a){e.getEditorPanel().setReadOnly(!1);e.getEditorPanel().setValue(a,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+g.Common.getProjectName()+
b})};a.setEditorTheme=function(a){null!=a&&null!=e.getEditorPanel()&&e.getEditorPanel().setTheme(a)};a.showEditorBreakpoints=function(){e.getEditorBreakpointManager().showEditorBreakpoints()};a.updateEditorFont=function(a,b){var c;c=a.split(",");for(var d="",f=0;f<c.length;f++)var h=c[f],h=g.Common.stringReplaceText(h,"'",""),h=g.Common.stringReplaceText(h,'"',""),h="'"+h.trim()+"'",d=d+(h+",");c=d+"monospace";e.getEditorPanel().setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,
fontFamily:c,fontSize:b})}})(r=l.FileEditor||(l.FileEditor={}))});
