define("require exports jquery ace w2ui common socket problem tree history project status keys commands".split(" "),function(P,m,t,q,C,g,K,L,n,M,w,N,O,r){var F=function(){function a(b){this._editorBreakpointManager=new D(this);this._editorHighlightManager=new E(this);this._editorPanel=b;this._editorHistory={};this._editorMarkers={};this._editorBreakpoints={}}a.prototype.activateEditor=function(){O.KeyBinder.bindKeys();w.Project.changeProjectFont();x.scrollEditorToPosition();x.updateProjectTabOnChange()};
a.prototype.updateResourcePath=function(b,a){window.location.hash=b.getProjectPath();this._editorResource=b;this._editorReadOnly=a};a.prototype.getHistoryForResource=function(b){if(b){b=b.getResourcePath();var a=this._editorHistory[b];a||(a=this._editorHistory[b]=new y(-1,null,null,null,null));return a}return new y(-1,null,null,null,null)};a.prototype.getEditorBreakpointManager=function(){return this._editorBreakpointManager};a.prototype.getEditorHighlightManager=function(){return this._editorHighlightManager};
a.prototype.getEditorResource=function(){return this._editorResource};a.prototype.isEditorReadOnly=function(){return this._editorReadOnly};a.prototype.getEditorPanel=function(){return this._editorPanel};a.prototype.getEditorMarkers=function(){return this._editorMarkers};a.prototype.getEditorBreakpoints=function(){return this._editorBreakpoints};return a}();m.FileEditorView=F;var D=function(){function a(b){this._editorView=b}a.prototype.getEditorView=function(){return this._editorView};a.prototype.clearEditorBreakpoint=
function(b){var a=this.getEditorView().getEditorPanel().getSession(),c=a.getBreakpoints();b=parseInt(b);for(var l in c)if(c.hasOwnProperty(l)){var d=parseInt(l);d==b&&a.clearBreakpoint(d)}this.showEditorBreakpoints()};a.prototype.clearEditorBreakpoints=function(){var b=this.getEditorView().getEditorPanel().getSession(),a=b.getBreakpoints(),c;for(c in a)a.hasOwnProperty(c)&&b.clearBreakpoint(c)};a.prototype.showEditorBreakpoints=function(){var b=this.getEditorView().getEditorBreakpoints(),a=[],c=1,
l;for(l in b)if(b.hasOwnProperty(l)){var d=b[l],h;for(h in d)if(d.hasOwnProperty(h)&&1==d[h]){var k=n.FileTree.createResourcePath(l),g="\x3cdiv class\x3d'breakpointEnabled'\x3e"+k.getProjectPath()+"\x3c/div\x3e";a.push({recid:c++,name:g,location:"Line "+h,resource:k.getProjectPath(),line:parseInt(h),script:k.getResourcePath()})}}C.w2ui.breakpoints.records=a;C.w2ui.breakpoints.refresh();r.Command.updateScriptBreakpoints()};a.prototype.setEditorBreakpoint=function(b,a){var c=this.getEditorView().getEditorBreakpoints(),
f=parseInt(b);if(null!=this.getEditorView().getEditorResource()){var d=this.getEditorView().getEditorPanel().getSession(),h=c[this.getEditorView().getEditorResource().getFilePath()];a?d.setBreakpoint(f):d.clearBreakpoint(f);null==h&&(h={},c[this.getEditorView().getEditorResource().getFilePath()]=h);h[f+1]=a}this.showEditorBreakpoints()};a.prototype.toggleEditorBreakpoint=function(b){var a=this.getEditorView().getEditorBreakpoints();if(null!=this.getEditorView().getEditorResource()){var c=this.getEditorView().getEditorPanel().getSession(),
l=c.getBreakpoints(),d=a[this.getEditorView().getEditorResource().getFilePath()],h=!1,k;for(k in l)if(k==b){h=!0;break}h?c.clearBreakpoint(b):c.setBreakpoint(b);b=parseInt(b);null==d?(d={},d[b+1]=!0,a[this.getEditorView().getEditorResource().getFilePath()]=d):d[b+1]=1==d[b+1]?!1:!0}this.showEditorBreakpoints()};a.prototype.restoreResourceBreakpoints=function(){var a=this.getEditorView();if(a.getEditorResource()){var f=a.getEditorResource().getFilePath(),a=a.getEditorBreakpoints()[f];if(null!=a)for(var c in a)a.hasOwnProperty(c)&&
1==a[c]&&this.setEditorBreakpoint(parseInt(c)-1,!0)}};return a}();m.FileEditorBreakpointManager=D;var E=function(){function a(a){this._editorView=a}a.prototype.getEditorView=function(){return this._editorView};a.prototype.clearEditorHighlights=function(){var a=this.getEditorView().getEditorPanel().getSession(),f=this.getEditorView().getEditorMarkers();this.getEditorView().getEditorResource();for(var c in f)if(f.hasOwnProperty(c)){var l=f[c];null!=l&&(a.removeMarker(l.getMarker()),delete f[c])}};a.prototype.showEditorLine=
function(a){this.getEditorView().getEditorPanel();this.getEditorView().getEditorPanel().resize(!0);if(1<a){var b=a-1;this.getCurrentLineForEditor()!=b&&(this.getEditorView().getEditorPanel().scrollToLine(b,!0,!0,function(){}),this.getEditorView().getEditorPanel().gotoLine(a),this.getEditorView().getEditorPanel().focus())}else this.getEditorView().getEditorPanel().scrollToLine(0,!0,!0,function(){}),this.getEditorView().getEditorPanel().focus()};a.prototype.clearEditorHighlight=function(a){var b=this.getEditorView().getEditorPanel().getSession();
a=this.getEditorView().getEditorMarkers()[a];null!=a&&b.removeMarker(a.getMarker())};a.prototype.createEditorHighlight=function(a,f){var b=q.ace.require("ace/range").Range,l=this.getEditorView().getEditorPanel().getSession(),d=this.getEditorView().getEditorMarkers(),h=d[a];this.clearEditorHighlights();b=l.addMarker(new b(a-1,0,a-1,1),f,"fullLine");b=new z(a,f,b);d[a]=b;return h?h.getStyle()!=f:!1};a.prototype.createMultipleEditorHighlights=function(a,f){for(var b=q.ace.require("ace/range").Range,
l=this.getEditorView().getEditorPanel().getSession(),d=this.getEditorView().getEditorMarkers(),h=!1,k=0;k<a.length;k++){var g=a[k];(g=d[g])?g.getStyle()!=f&&(h=!0):h=!0}this.clearEditorHighlights();for(k=0;k<a.length;k++){var g=a[k],m=l.addMarker(new b(g-1,0,g-1,1),f,"fullLine"),m=new z(g,f,m);d[g]=m}return h};a.prototype.getCurrentLineForEditor=function(){return this.getEditorView().getEditorPanel().getSelectionRange().start.row};return a}();m.FileEditorHighlightManager=E;var z=function(){function a(a,
f,c){this._style=f;this._line=a;this._marker=c}a.prototype.getLine=function(){return this._line};a.prototype.getMarker=function(){return this._marker};a.prototype.getStyle=function(){return this._style};return a}();m.FileEditorMarker=z;var y=function(){function a(a,f,c,l,d){this._lastModified=a;this._undoState=f;this._position=c;this._originalText=d;this._savedText=l;this._changeMade=!1}a.prototype.restoreUndoManager=function(a,f){var b=new q.ace.UndoManager;if(f==this._savedText&&this._undoState){var l=
this._undoState.getUndoStack(),d=this._undoState.getRedoStack(),h;for(h in l)l.hasOwnProperty(h)&&(b.$undoStack[h]=l[h]);for(var g in d)d.hasOwnProperty(g)&&(b.$redoStack[g]=l[g]);b.$doc=a;b.dirtyCounter=this._undoState.getDirtyCounter()}a.setUndoManager(b)};a.prototype.restoreScrollPosition=function(a,f){if(this._position){var b=this._position.getScroll(),g=this._position.getRow(),d=this._position.getColumn();0<=g&&0<=d?f.selection.moveTo(g,d):f.gotoLine(1);a.setScrollTop(b)}else f.gotoLine(1),a.setScrollTop(0);
f.focus()};a.prototype.saveHistory=function(a){a.getSource();this._savedText=a.getSource();this._lastModified=a.getLastModified();this._undoState=a.getUndoState();this._position=a.getPosition()};a.prototype.updateHistory=function(a,f){a!=this._savedText&&(this._position=this._undoState=null);this._savedText=a;this._originalText=f;this._changeMade=!1};a.prototype.invalidateHistory=function(){this._changeMade=!1;this._undoState=null;this._lastModified=-1;this._savedText=this._originalText=null};a.prototype.touchHistory=
function(a){a!=this._savedText&&(this._lastModified=g.Common.currentTime());this._savedText=a};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getOriginalText=function(){return this._originalText};a.prototype.getSavedText=function(){return this._savedText};return a}();m.FileEditorHistory=y;var G=function(){function a(a,f,c){this._undoStack=a;this._redoStack=f;this._dirtyCounter=c}a.prototype.getUndoStack=function(){return this._undoStack};a.prototype.getRedoStack=function(){return this._redoStack};
a.prototype.getDirtyCounter=function(){return this._dirtyCounter};return a}();m.FileEditorUndoState=G;var H=function(){function a(a,f,c,g,d,h,k){this._lastModified=a;this._breakpoints=f;this._resource=c;this._undoState=g;this._isReadOnly=k;this._position=d;this._source=h}a.prototype.isStateValid=function(){return this._resource&&null!=this._source&&""!=this._source};a.prototype.isReadOnly=function(){return this._isReadOnly};a.prototype.getResource=function(){return this._resource};a.prototype.getPosition=
function(){return this._position};a.prototype.getUndoState=function(){return this._undoState};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getBreakpoints=function(){return this._breakpoints};a.prototype.getSource=function(){return this._source};return a}();m.FileEditorState=H;var A=function(){function a(a,f,c){this._row=a;this._column=f;this._scroll=c}a.prototype.getRow=function(){return this._row};a.prototype.getColumn=function(){return this._column};a.prototype.getScroll=
function(){return this._scroll};return a}();m.FileEditorPosition=A;var B=function(){function a(a,f,c,g){this._lastModified=a;this._isCurrent=g;this._resource=f;this._source=c}a.prototype.isBufferValid=function(){return this._resource&&null!=this._source};a.prototype.isBufferCurrent=function(){return this._isCurrent};a.prototype.getResource=function(){return this._resource};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getSource=function(){return this._source};return a}();
m.FileEditorBuffer=B;var I;(function(a){function b(a){return{getCompletions:function(b,f,d,h,k){f=b.getValue();var c=b.session.getLine(d.row);b=a.getEditorResource().getProjectPath();c=c.substring(0,d.column);d=JSON.stringify({resource:b,line:d.row+1,complete:c,source:f,prefix:h});t.ajax({contentType:"application/json",data:d,dataType:"json",success:function(a){var b=a.expression;if(b){var u=Math.max(0,b.lastIndexOf(".")+1);a=a.tokens;var c=[],d;for(d in a)if(a.hasOwnProperty(d)){var f=a[d];g.Common.stringStartsWith(d,
b)&&(d=d.substring(u));c.push({className:"autocomplete_"+f,token:d,value:d,score:300,meta:f})}k(null,c)}},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+g.Common.getProjectName()})}}}a.createFileEditorView=function(a){var c=q.ace.edit(a),f=new F(c);a=b(f);c.completers=[a];c.getSession().setMode("ace/mode/tern");c.getSession().setTabSize(3);c.setReadOnly(!1);c.setAutoScrollEditorIntoView(!0);c.getSession().setUseSoftTabs(!0);c.commands.removeCommand("replace");
c.commands.removeCommand("find");c.commands.removeCommand("expandToMatching");c.commands.removeCommand("expandtoline");c.setShowPrintMargin(!1);c.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0});c.on("click",function(a){a=c.getOptions();var b={};console.log("Focus editor on click: options\x3d["+typeof a+"] -\x3e ",a);c.focus();for(var d in a)a.hasOwnProperty(d)&&(b[d]=a[d]);b.readOnly=!1;console.log("Update after click: ",b);c.setOptions(b);c.setReadOnly(!1)});c.on("guttermousedown",
function(a){var b=a.domEvent.target;-1==b.className.indexOf("ace_gutter-cell")||!c.isFocused()||a.clientX>25+b.getBoundingClientRect().left||(b=a.getDocumentPosition().row,f.getEditorBreakpointManager().toggleEditorBreakpoint(b),a.stop())});"undefined"!==typeof java&&c.setScrollSpeed(.05);return f}})(I=m.FileEditorBuilder||(m.FileEditorBuilder={}));var J;(function(a){a.resolveEditorMode=function(a){a=a.toLowerCase();if(g.Common.stringEndsWith(a,".tern"))return"ace/mode/tern";if(g.Common.stringEndsWith(a,
".policy"))return"ace/mode/policy";if(g.Common.stringEndsWith(a,".xml"))return"ace/mode/xml";if(g.Common.stringEndsWith(a,".json"))return"ace/mode/json";if(g.Common.stringEndsWith(a,".sql"))return"ace/mode/sql";if(g.Common.stringEndsWith(a,".pl"))return"ace/mode/perl";if(g.Common.stringEndsWith(a,".kt"))return"ace/mode/kotlin";if(g.Common.stringEndsWith(a,".js"))return"ace/mode/javascript";if(g.Common.stringEndsWith(a,".ts"))return"ace/mode/typescript";if(g.Common.stringEndsWith(a,".java"))return"ace/mode/java";
if(g.Common.stringEndsWith(a,".groovy"))return"ace/mode/groovy";if(g.Common.stringEndsWith(a,".py"))return"ace/mode/python";if(g.Common.stringEndsWith(a,".html")||g.Common.stringEndsWith(a,".htm"))return"ace/mode/html";if(g.Common.stringEndsWith(a,".txt"))return"ace/mode/text";if(g.Common.stringEndsWith(a,".properties"))return"ace/mode/properties";if(g.Common.stringEndsWith(a,".gitignore"))return"ace/mode/text";if(g.Common.stringEndsWith(a,".project"))return"ace/mode/xml";g.Common.stringEndsWith(a,
".classpath");return"ace/mode/text"}})(J=m.FileEditorModeMapper||(m.FileEditorModeMapper={}));var x;(function(a){function b(){var a;a=e.getEditorPanel().getSession().getUndoManager();var b=t.extend(!0,{},a.$undoStack),c=t.extend(!0,{},a.$redoStack);a=new G(b,c,a.dirtyCounter);b=e.getEditorPanel().getSession().getScrollTop();b=(c=e.getEditorPanel().selection.getCursor())?new A(c.row,c.column,b):new A(null,null,b);var c=f(),d=-1,g=null;c&&(g=c.getSource(),d=c.getLastModified());return new H(d,e.getEditorBreakpoints(),
e.getEditorResource(),a,b,g,e.isEditorReadOnly())}function f(){if(e.getEditorResource()){var a=e.getEditorResource().getResourcePath();return c(a)}return null}function c(a){a=n.FileTree.createResourcePath(a);var b=e.getHistoryForResource(a),c=b.getLastModified();return k(a.getResourcePath())?(b=e.getEditorPanel().getValue(),new B(c,a,b,!0)):new B(c,a,b.getSavedText(),!1)}function l(a){e.getEditorPanel().setReadOnly(a)}function d(){if(null!=e.getEditorResource()){var a=e.getHistoryForResource(e.getEditorResource()),
b=e.getEditorPanel().getValue(),a=a.getOriginalText();return b!=a}return!1}function h(a){if(k(a))return d();a=n.FileTree.createResourcePath(a);var b=e.getHistoryForResource(a);a=b.getOriginalText();b=b.getSavedText();return a!=b}function k(a){return null!=e.getEditorResource()&&e.getEditorResource().getResourcePath()==a?!0:!1}function m(){var a=e.getEditorPanel().getSession();e.getHistoryForResource(e.getEditorResource()).restoreScrollPosition(a,e.getEditorPanel())}function q(a){w.Project.markEditorTab(a,
h(a))}var e=null;a.createEditor=function(){e=I.createFileEditorView("editor");e.activateEditor();K.EventBus.createTermination(function(){e.getEditorHighlightManager().clearEditorHighlights()})};a.clearEditorHighlights=function(){e.getEditorHighlightManager().clearEditorHighlights()};a.showEditorLine=function(a){e.getEditorHighlightManager().showEditorLine(a)};a.clearEditorHighlight=function(a){e.getEditorHighlightManager().clearEditorHighlight(a)};a.createEditorHighlight=function(a,b){return e.getEditorHighlightManager().createEditorHighlight(a,
b)};a.createMultipleEditorHighlights=function(a,b){return e.getEditorHighlightManager().createMultipleEditorHighlights(a,b)};a.findAndReplaceTextInEditor=function(){var a=b().getResource();r.Command.searchAndReplaceFiles(a.getProjectPath())};a.findTextInEditor=function(){var a=b().getResource();r.Command.searchFiles(a.getProjectPath())};a.addEditorKeyBinding=function(a,b){e.getEditorPanel().commands.addCommand({name:a.editor,bindKey:{win:a.editor,mac:a.editor},exec:function(a){b&&b()}})};a.resizeEditor=
function(){var a=document.getElementById("editor").offsetWidth,b=document.getElementById("editor").offsetHeight;console.log("Resize editor "+a+"x"+b);e.getEditorPanel().setAutoScrollEditorIntoView(!0);e.getEditorPanel().resize(!0)};a.currentEditorState=b;a.clearSavedEditorBuffer=function(a){var b=n.FileTree.createResourcePath(a);e.getHistoryForResource(b).invalidateHistory();q(a)};a.currrentEditorBuffer=f;a.getEditorBufferForResource=c;a.updateEditor=function(d){var f=d.getResourcePath(),g=d.isHistorical()||
d.isError(),h=d.getFileContent(),k;k=d.getFileContent();if(!d.isHistorical()&&!d.isError()){var p=d.getResourcePath().getResourcePath(),p=c(p);p.getSource()&&p.getLastModified()>d.getLastModified()&&(k=p.getSource())}d=e.getEditorPanel().getSession();var p=d.getMode(),u=J.resolveEditorMode(f.getResourcePath()),n=b();if(!n.isReadOnly()){var v=n.getResource(),v=e.getHistoryForResource(v);n.isStateValid()?v.saveHistory(n):v.invalidateHistory()}u!=p&&d.setMode({path:u,v:Date.now()});g?(h=k,e.getEditorPanel().setReadOnly(!1),
e.getEditorPanel().setValue(h,1)):(p=e.getHistoryForResource(f),e.getEditorPanel().setReadOnly(!1),e.getEditorPanel().setValue(k,1),p.updateHistory(k,h),p.restoreUndoManager(d,k));var h=e.getEditorPanel().getSession(),r;for(r in h.$backMarkers)h.removeMarker(r);e.getEditorHighlightManager().clearEditorHighlights();e.getEditorBreakpointManager().clearEditorBreakpoints();t("#currentFile").html("");l(g);e.updateResourcePath(f,g);L.ProblemManager.highlightProblems();e.getEditorBreakpointManager().restoreResourceBreakpoints();
w.Project.createEditorTab();M.History.showFileHistory();N.StatusPanel.showActiveFile(e.getEditorResource().getProjectPath());a.showEditorFileInTree();m();q(e.getEditorResource().getResourcePath())};a.focusEditor=function(){e.getEditorPanel().focus();e.getEditorPanel().setReadOnly(!1)};a.setReadOnly=l;a.showEditorFileInTree=function(){var a=b().getResource();n.FileTree.showTreeNode("explorerTree",a)};a.getCurrentLineForEditor=function(){return e.getEditorPanel().getSelectionRange().start.row};a.getSelectedText=
function(){return e.getEditorPanel().getSelectedText()};a.isEditorChanged=d;a.isEditorChangedForPath=h;a.scrollEditorToPosition=m;a.updateProjectTabOnChange=function(){e.getEditorPanel().on("input",function(){var a=e.getEditorResource(),a=e.getHistoryForResource(a),b=e.getEditorPanel().getValue();a.touchHistory(b);q(e.getEditorResource().getResourcePath())})};a.formatEditorSource=function(){var a=e.getEditorPanel().getValue(),b=e.getEditorResource().getFilePath();t.ajax({contentType:"text/plain",
data:a,success:function(a){e.getEditorPanel().setReadOnly(!1);e.getEditorPanel().setValue(a,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+g.Common.getProjectName()+b})};a.setEditorTheme=function(a){null!=a&&null!=e.getEditorPanel()&&e.getEditorPanel().setTheme(a)};a.showEditorBreakpoints=function(){e.getEditorBreakpointManager().showEditorBreakpoints()};a.updateEditorFont=function(a,b){var c;c=a.split(",");for(var d="",f=0;f<c.length;f++)var h=c[f],h=
g.Common.stringReplaceText(h,"'",""),h=g.Common.stringReplaceText(h,'"',""),h="'"+h.trim()+"'",d=d+(h+",");c=d+"monospace";e.getEditorPanel().setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,fontFamily:c,fontSize:b})}})(x=m.FileEditor||(m.FileEditor={}))});
