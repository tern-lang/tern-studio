define("require exports jquery ace w2ui common socket problem tree history project status keys commands".split(" "),function(O,l,t,p,A,g,I,J,n,K,u,L,M,v){var D=function(){function a(b){this._editorBreakpointManager=new B(this);this._editorHighlightManager=new C(this);this._editorPanel=b;this._editorHistory={};this._editorMarkers={};this._editorBreakpoints={}}a.prototype.activateEditor=function(){M.KeyBinder.bindKeys();u.Project.changeProjectFont();q.scrollEditorToPosition();q.updateProjectTabOnChange()};
a.prototype.updateResourcePath=function(b,a){window.location.hash=b.getProjectPath();this._editorResource=b;this._editorReadOnly=a};a.prototype.getHistoryForResource=function(b){if(b){b=b.getResourcePath();var a=this._editorHistory[b];a||(a=this._editorHistory[b]=new w(-1,null,null,null,null));return a}return new w(-1,null,null,null,null)};a.prototype.getEditorBreakpointManager=function(){return this._editorBreakpointManager};a.prototype.getEditorHighlightManager=function(){return this._editorHighlightManager};
a.prototype.getEditorResource=function(){return this._editorResource};a.prototype.isEditorReadOnly=function(){return this._editorReadOnly};a.prototype.getEditorPanel=function(){return this._editorPanel};a.prototype.getEditorMarkers=function(){return this._editorMarkers};a.prototype.getEditorBreakpoints=function(){return this._editorBreakpoints};return a}();l.FileEditorView=D;var B=function(){function a(b){this._editorView=b}a.prototype.getEditorView=function(){return this._editorView};a.prototype.clearEditorBreakpoint=
function(b){var a=this.getEditorView().getEditorPanel().getSession(),c=a.getBreakpoints();b=parseInt(b);for(var k in c)if(c.hasOwnProperty(k)){var d=parseInt(k);d==b&&a.clearBreakpoint(d)}this.showEditorBreakpoints()};a.prototype.clearEditorBreakpoints=function(){var b=this.getEditorView().getEditorPanel().getSession(),a=b.getBreakpoints(),c;for(c in a)a.hasOwnProperty(c)&&b.clearBreakpoint(c)};a.prototype.showEditorBreakpoints=function(){var b=this.getEditorView().getEditorBreakpoints(),a=[],c=1,
k;for(k in b)if(b.hasOwnProperty(k)){var d=b[k],h;for(h in d)if(d.hasOwnProperty(h)&&1==d[h]){var m=n.FileTree.createResourcePath(k),g="\x3cdiv class\x3d'breakpointEnabled'\x3e"+m.getProjectPath()+"\x3c/div\x3e";a.push({recid:c++,name:g,location:"Line "+h,resource:m.getProjectPath(),line:parseInt(h),script:m.getResourcePath()})}}A.w2ui.breakpoints.records=a;A.w2ui.breakpoints.refresh();v.Command.updateScriptBreakpoints()};a.prototype.setEditorBreakpoint=function(a,e){var b=this.getEditorView().getEditorBreakpoints(),
k=parseInt(a);if(null!=this.getEditorView().getEditorResource()){var d=this.getEditorView().getEditorPanel().getSession(),h=b[this.getEditorView().getEditorResource().getFilePath()];e?d.setBreakpoint(k):d.clearBreakpoint(k);null==h&&(h={},b[this.getEditorView().getEditorResource().getFilePath()]=h);h[k+1]=e}this.showEditorBreakpoints()};a.prototype.toggleEditorBreakpoint=function(a){var b=this.getEditorView().getEditorBreakpoints();if(null!=this.getEditorView().getEditorResource()){var c=this.getEditorView().getEditorPanel().getSession(),
k=c.getBreakpoints(),d=b[this.getEditorView().getEditorResource().getFilePath()],h=!1,m;for(m in k)if(m==a){h=!0;break}h?c.clearBreakpoint(a):c.setBreakpoint(a);a=parseInt(a);null==d?(d={},d[a+1]=!0,b[this.getEditorView().getEditorResource().getFilePath()]=d):d[a+1]=1==d[a+1]?!1:!0}this.showEditorBreakpoints()};a.prototype.restoreResourceBreakpoints=function(){var a=this.getEditorView();if(a.getEditorResource()){var e=a.getEditorResource().getFilePath(),a=a.getEditorBreakpoints()[e];if(null!=a)for(var c in a)a.hasOwnProperty(c)&&
1==a[c]&&this.setEditorBreakpoint(parseInt(c)-1,!0)}};return a}();l.FileEditorBreakpointManager=B;var C=function(){function a(a){this._editorView=a}a.prototype.getEditorView=function(){return this._editorView};a.prototype.clearEditorHighlights=function(){var a=this.getEditorView().getEditorPanel().getSession(),e=this.getEditorView().getEditorMarkers();this.getEditorView().getEditorResource();for(var c in e)if(e.hasOwnProperty(c)){var k=e[c];null!=k&&(a.removeMarker(k.getMarker()),delete e[c])}};a.prototype.showEditorLine=
function(a){this.getEditorView().getEditorPanel();this.getEditorView().getEditorPanel().resize(!0);if(1<a){var b=a-1;this.getCurrentLineForEditor()!=b&&(this.getEditorView().getEditorPanel().scrollToLine(b,!0,!0,function(){}),this.getEditorView().getEditorPanel().gotoLine(a),this.getEditorView().getEditorPanel().focus())}else this.getEditorView().getEditorPanel().scrollToLine(0,!0,!0,function(){}),this.getEditorView().getEditorPanel().focus()};a.prototype.clearEditorHighlight=function(a){var b=this.getEditorView().getEditorPanel().getSession();
a=this.getEditorView().getEditorMarkers()[a];null!=a&&b.removeMarker(a.getMarker())};a.prototype.createEditorHighlight=function(a,e){var b=p.ace.require("ace/range").Range,k=this.getEditorView().getEditorPanel().getSession(),d=this.getEditorView().getEditorMarkers(),h=d[a];this.clearEditorHighlights();b=k.addMarker(new b(a-1,0,a-1,1),e,"fullLine");b=new x(a,e,b);d[a]=b;return h?h.getStyle()!=e:!1};a.prototype.createMultipleEditorHighlights=function(a,e){for(var b=p.ace.require("ace/range").Range,
k=this.getEditorView().getEditorPanel().getSession(),d=this.getEditorView().getEditorMarkers(),h=!1,m=0;m<a.length;m++){var g=a[m];(g=d[g])?g.getStyle()!=e&&(h=!0):h=!0}this.clearEditorHighlights();for(m=0;m<a.length;m++){var g=a[m],l=k.addMarker(new b(g-1,0,g-1,1),e,"fullLine"),l=new x(g,e,l);d[g]=l}return h};a.prototype.getCurrentLineForEditor=function(){return this.getEditorView().getEditorPanel().getSelectionRange().start.row};return a}();l.FileEditorHighlightManager=C;var x=function(){function a(a,
e,c){this._style=e;this._line=a;this._marker=c}a.prototype.getLine=function(){return this._line};a.prototype.getMarker=function(){return this._marker};a.prototype.getStyle=function(){return this._style};return a}();l.FileEditorMarker=x;var w=function(){function a(a,e,c,k,d){this._lastModified=a;this._undoState=e;this._position=c;this._originalText=d;this._savedText=k;this._changeMade=!1}a.prototype.restoreUndoManager=function(a,e){var b=new p.ace.UndoManager;if(e==this._savedText&&this._undoState){var k=
this._undoState.getUndoStack(),d=this._undoState.getRedoStack(),h;for(h in k)k.hasOwnProperty(h)&&(b.$undoStack[h]=k[h]);for(var g in d)d.hasOwnProperty(g)&&(b.$redoStack[g]=k[g]);b.$doc=a;b.dirtyCounter=this._undoState.getDirtyCounter()}a.setUndoManager(b)};a.prototype.restoreScrollPosition=function(a,e){if(this._position){var b=this._position.getScroll(),k=this._position.getRow(),d=this._position.getColumn();0<=k&&0<=d?e.selection.moveTo(k,d):e.gotoLine(1);a.setScrollTop(b)}else e.gotoLine(1),a.setScrollTop(0);
e.focus()};a.prototype.saveHistory=function(a){a.getSource();this._savedText=a.getSource();this._lastModified=a.getLastModified();this._undoState=a.getUndoState();this._position=a.getPosition()};a.prototype.updateHistory=function(a,e){a!=this._savedText&&(this._position=this._undoState=null);this._savedText=a;this._originalText=e;this._changeMade=!1};a.prototype.invalidateHistory=function(){this._changeMade=!1;this._undoState=null;this._lastModified=-1;this._savedText=this._originalText=null};a.prototype.touchHistory=
function(a){a!=this._savedText&&(this._lastModified=g.Common.currentTime());this._savedText=a};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getOriginalText=function(){return this._originalText};a.prototype.getSavedText=function(){return this._savedText};return a}();l.FileEditorHistory=w;var E=function(){function a(a,e,c){this._undoStack=a;this._redoStack=e;this._dirtyCounter=c}a.prototype.getUndoStack=function(){return this._undoStack};a.prototype.getRedoStack=function(){return this._redoStack};
a.prototype.getDirtyCounter=function(){return this._dirtyCounter};return a}();l.FileEditorUndoState=E;var F=function(){function a(a,e,c,k,d,h,g){this._lastModified=a;this._breakpoints=e;this._resource=c;this._undoState=k;this._isReadOnly=g;this._position=d;this._source=h}a.prototype.isStateValid=function(){return this._resource&&null!=this._source&&""!=this._source};a.prototype.isReadOnly=function(){return this._isReadOnly};a.prototype.getResource=function(){return this._resource};a.prototype.getPosition=
function(){return this._position};a.prototype.getUndoState=function(){return this._undoState};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getBreakpoints=function(){return this._breakpoints};a.prototype.getSource=function(){return this._source};return a}();l.FileEditorState=F;var y=function(){function a(a,e,c){this._row=a;this._column=e;this._scroll=c}a.prototype.getRow=function(){return this._row};a.prototype.getColumn=function(){return this._column};a.prototype.getScroll=
function(){return this._scroll};return a}();l.FileEditorPosition=y;var z=function(){function a(a,e,c,k){this._lastModified=a;this._isCurrent=k;this._resource=e;this._source=c}a.prototype.isBufferValid=function(){return this._resource&&null!=this._source};a.prototype.isBufferCurrent=function(){return this._isCurrent};a.prototype.getResource=function(){return this._resource};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getSource=function(){return this._source};return a}();
l.FileEditorBuffer=z;var N=function(){function a(a,e,c,k,d,h){this._editorView=a;this._resourcePath=e;this._editorMode=c;this._editorText=k;this._isReadOnly=d;this._lastModified=h}a.prototype.isReadOnly=function(){return this._isReadOnly};a.prototype.getEditorView=function(){return this._editorView};a.prototype.getResourcePath=function(){return this._resourcePath};a.prototype.getEditorMode=function(){return this._editorMode};a.prototype.getEditorText=function(){return this._editorText};a.prototype.getLastModified=
function(){return this._lastModified};return a}(),G;(function(a){function b(a){return{getCompletions:function(b,e,d,h,m){e=b.getValue();var c=b.session.getLine(d.row);b=a.getEditorResource().getProjectPath();c=c.substring(0,d.column);d=JSON.stringify({resource:b,line:d.row+1,complete:c,source:e,prefix:h});t.ajax({contentType:"application/json",data:d,dataType:"json",success:function(a){var b=a.expression;if(b){var r=Math.max(0,b.lastIndexOf(".")+1);a=a.tokens;var c=[],d;for(d in a)if(a.hasOwnProperty(d)){var e=
a[d];g.Common.stringStartsWith(d,b)&&(d=d.substring(r));c.push({className:"autocomplete_"+e,token:d,value:d,score:300,meta:e})}m(null,c)}},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+g.Common.getProjectName()})}}}a.createFileEditorView=function(a){var c=p.ace.edit(a),e=new D(c);a=b(e);c.completers=[a];c.getSession().setMode("ace/mode/tern");c.getSession().setTabSize(3);c.setReadOnly(!1);c.setAutoScrollEditorIntoView(!0);c.getSession().setUseSoftTabs(!0);
c.commands.removeCommand("replace");c.commands.removeCommand("find");c.commands.removeCommand("expandToMatching");c.commands.removeCommand("expandtoline");c.setShowPrintMargin(!1);c.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0});c.on("click",function(a){a=c.getOptions();var b={};console.log("Focus editor on click: options\x3d["+typeof a+"] -\x3e ",a);c.focus();for(var d in a)a.hasOwnProperty(d)&&(b[d]=a[d]);b.readOnly=!1;console.log("Update after click: ",b);c.setOptions(b);
c.setReadOnly(!1)});c.on("guttermousedown",function(a){var b=a.domEvent.target;-1==b.className.indexOf("ace_gutter-cell")||!c.isFocused()||a.clientX>25+b.getBoundingClientRect().left||(b=a.getDocumentPosition().row,e.getEditorBreakpointManager().toggleEditorBreakpoint(b),a.stop())});"undefined"!==typeof java&&c.setScrollSpeed(.05);return e}})(G=l.FileEditorBuilder||(l.FileEditorBuilder={}));var H;(function(a){a.resolveEditorMode=function(a){a=a.toLowerCase();if(g.Common.stringEndsWith(a,".tern"))return"ace/mode/tern";
if(g.Common.stringEndsWith(a,".policy"))return"ace/mode/policy";if(g.Common.stringEndsWith(a,".xml"))return"ace/mode/xml";if(g.Common.stringEndsWith(a,".json"))return"ace/mode/json";if(g.Common.stringEndsWith(a,".sql"))return"ace/mode/sql";if(g.Common.stringEndsWith(a,".pl"))return"ace/mode/perl";if(g.Common.stringEndsWith(a,".kt"))return"ace/mode/kotlin";if(g.Common.stringEndsWith(a,".js"))return"ace/mode/javascript";if(g.Common.stringEndsWith(a,".ts"))return"ace/mode/typescript";if(g.Common.stringEndsWith(a,
".java"))return"ace/mode/java";if(g.Common.stringEndsWith(a,".groovy"))return"ace/mode/groovy";if(g.Common.stringEndsWith(a,".py"))return"ace/mode/python";if(g.Common.stringEndsWith(a,".html")||g.Common.stringEndsWith(a,".htm"))return"ace/mode/html";if(g.Common.stringEndsWith(a,".txt"))return"ace/mode/text";if(g.Common.stringEndsWith(a,".properties"))return"ace/mode/properties";if(g.Common.stringEndsWith(a,".gitignore"))return"ace/mode/text";if(g.Common.stringEndsWith(a,".project"))return"ace/mode/xml";
g.Common.stringEndsWith(a,".classpath");return"ace/mode/text"}})(H=l.FileEditorModeMapper||(l.FileEditorModeMapper={}));var q;(function(a){function b(){var a;a=f.getEditorPanel().getSession().getUndoManager();var b=t.extend(!0,{},a.$undoStack),c=t.extend(!0,{},a.$redoStack);a=new E(b,c,a.dirtyCounter);b=f.getEditorPanel().getSession().getScrollTop();b=(c=f.getEditorPanel().selection.getCursor())?new y(c.row,c.column,b):new y(null,null,b);var c=e(),d=-1,g=null;c&&(g=c.getSource(),d=c.getLastModified());
return new F(d,f.getEditorBreakpoints(),f.getEditorResource(),a,b,g,f.isEditorReadOnly())}function e(){if(f.getEditorResource()){var a=f.getEditorResource().getResourcePath();return c(a)}return null}function c(a){a=n.FileTree.createResourcePath(a);var b=f.getHistoryForResource(a),c=b.getLastModified(),r=a.getResourcePath();return l(r)?(b=f.getEditorPanel().getValue(),new z(c,a,b,!0)):new z(c,a,b.getSavedText(),!1)}function k(a){f.getEditorPanel().setReadOnly(a)}function d(){if(null!=f.getEditorResource()){var a=
f.getHistoryForResource(f.getEditorResource()),b=f.getEditorPanel().getValue(),a=a.getOriginalText();return b!=a}return!1}function h(a){if(l(a))return d();a=n.FileTree.createResourcePath(a);var b=f.getHistoryForResource(a);a=b.getOriginalText();b=b.getSavedText();return a!=b}function l(a){return null!=f.getEditorResource()&&f.getEditorResource().getResourcePath()==a?!0:!1}function p(){var a=f.getEditorPanel().getSession();f.getHistoryForResource(f.getEditorResource()).restoreScrollPosition(a,f.getEditorPanel())}
function q(a){u.Project.markEditorTab(a,h(a))}var f=null;a.createEditor=function(){f=G.createFileEditorView("editor");f.activateEditor();I.EventBus.createTermination(function(){f.getEditorHighlightManager().clearEditorHighlights()})};a.clearEditorHighlights=function(){f.getEditorHighlightManager().clearEditorHighlights()};a.showEditorLine=function(a){f.getEditorHighlightManager().showEditorLine(a)};a.clearEditorHighlight=function(a){f.getEditorHighlightManager().clearEditorHighlight(a)};a.createEditorHighlight=
function(a,b){return f.getEditorHighlightManager().createEditorHighlight(a,b)};a.createMultipleEditorHighlights=function(a,b){return f.getEditorHighlightManager().createMultipleEditorHighlights(a,b)};a.findAndReplaceTextInEditor=function(){var a=b().getResource();v.Command.searchAndReplaceFiles(a.getProjectPath())};a.findTextInEditor=function(){var a=b().getResource();v.Command.searchFiles(a.getProjectPath())};a.addEditorKeyBinding=function(a,b){f.getEditorPanel().commands.addCommand({name:a.editor,
bindKey:{win:a.editor,mac:a.editor},exec:function(a){b&&b()}})};a.resizeEditor=function(){var a=document.getElementById("editor").offsetWidth,b=document.getElementById("editor").offsetHeight;console.log("Resize editor "+a+"x"+b);f.getEditorPanel().setAutoScrollEditorIntoView(!0);f.getEditorPanel().resize(!0)};a.currentEditorState=b;a.clearSavedEditorBuffer=function(a){var b=n.FileTree.createResourcePath(a);f.getHistoryForResource(b).invalidateHistory();q(a)};a.currrentEditorBuffer=e;a.getEditorBufferForResource=
c;a.updateEditor=function(d){var e;e=d.getFileContent();if(!d.isHistorical()&&!d.isError()){var g=d.getResourcePath().getResourcePath(),h=d.getLastModified(),l=c(g),g=l.getSource(),l=l.getLastModified();g&&l>=h&&(e=g)}var h=d.getResourcePath(),l=h.getResourcePath(),g=d.isHistorical()||d.isError(),l=H.resolveEditorMode(l),m=d.getLastModified();e=new N(f,h,l,e,g,m);h=b();h.isReadOnly()||(g=h.getResource(),g=f.getHistoryForResource(g),h.isStateValid()?g.saveHistory(h):g.invalidateHistory());var h=f.getEditorPanel().getSession(),
g=h.getMode(),l=d.getFileContent(),r=e.getEditorMode(),m=e.getEditorText();d=e.isReadOnly();e=e.getResourcePath();r!=g&&h.setMode({path:r,v:Date.now()});d?(f.getEditorPanel().setReadOnly(!1),f.getEditorPanel().setValue(m,1)):(g=f.getHistoryForResource(e),f.getEditorPanel().setReadOnly(!1),f.getEditorPanel().setValue(m,1),g.updateHistory(m,l),g.restoreUndoManager(h,m));k(d);var h=f.getEditorPanel().getSession(),n;for(n in h.$backMarkers)h.removeMarker(n);f.getEditorHighlightManager().clearEditorHighlights();
f.getEditorBreakpointManager().clearEditorBreakpoints();t("#currentFile").html("");f.updateResourcePath(e,d);J.ProblemManager.highlightProblems();f.getEditorBreakpointManager().restoreResourceBreakpoints();u.Project.createEditorTab();K.History.showFileHistory();L.StatusPanel.showActiveFile(f.getEditorResource().getProjectPath());a.showEditorFileInTree();p();q(f.getEditorResource().getResourcePath())};a.focusEditor=function(){f.getEditorPanel().focus();f.getEditorPanel().setReadOnly(!1)};a.setReadOnly=
k;a.showEditorFileInTree=function(){var a=b().getResource();n.FileTree.showTreeNode("explorerTree",a)};a.getCurrentLineForEditor=function(){return f.getEditorPanel().getSelectionRange().start.row};a.getSelectedText=function(){return f.getEditorPanel().getSelectedText()};a.isEditorChanged=d;a.isEditorChangedForPath=h;a.scrollEditorToPosition=p;a.updateProjectTabOnChange=function(){f.getEditorPanel().on("input",function(){var a=f.getEditorResource(),a=f.getHistoryForResource(a),b=f.getEditorPanel().getValue();
a.touchHistory(b);q(f.getEditorResource().getResourcePath())})};a.formatEditorSource=function(){var a=f.getEditorPanel().getValue(),b=f.getEditorResource().getFilePath();t.ajax({contentType:"text/plain",data:a,success:function(a){f.getEditorPanel().setReadOnly(!1);f.getEditorPanel().setValue(a,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+g.Common.getProjectName()+b})};a.setEditorTheme=function(a){null!=a&&null!=f.getEditorPanel()&&f.getEditorPanel().setTheme(a)};
a.showEditorBreakpoints=function(){f.getEditorBreakpointManager().showEditorBreakpoints()};a.updateEditorFont=function(a,b){var c;c=a.split(",");for(var d="",e=0;e<c.length;e++)var h=c[e],h=g.Common.stringReplaceText(h,"'",""),h=g.Common.stringReplaceText(h,'"',""),h="'"+h.trim()+"'",d=d+(h+",");c=d+"monospace";f.getEditorPanel().setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,fontFamily:c,fontSize:b})}})(q=l.FileEditor||(l.FileEditor={}))});
