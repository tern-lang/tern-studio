define("require exports jquery ace w2ui common socket problem tree history project status keys commands".split(" "),function(W,e,x,B,J,c,S,T,A,U,C,V,D,E){var K=function(){function a(a){this._editorPanel=a;this._editorHistory={};this._editorMarkers={};this._editorBreakpoints={}}a.prototype.activateEditor=function(){D.KeyBinder.bindKeys();C.Project.changeProjectFont();z.scrollEditorToPosition();z.updateProjectTabOnChange()};a.prototype.updateResourcePath=function(a,m){window.location.hash=a.getProjectPath();
this._editorResource=a;this._editorReadOnly=m};a.prototype.getHistoryForResource=function(a){if(a){a=a.getResourcePath();var k=this._editorHistory[a];k||(k=this._editorHistory[a]=new u(-1,null,null,null,null));return k}return new u(-1,null,null,null,null)};a.prototype.getEditorResource=function(){return this._editorResource};a.prototype.isEditorReadOnly=function(){return this._editorReadOnly};a.prototype.getEditorPanel=function(){return this._editorPanel};a.prototype.getEditorMarkers=function(){return this._editorMarkers};
a.prototype.getEditorBreakpoints=function(){return this._editorBreakpoints};return a}();e.FileEditorView=K;var F=function(){function a(a,m,c){this._style=m;this._line=a;this._marker=c}a.prototype.getLine=function(){return this._line};a.prototype.getMarker=function(){return this._marker};a.prototype.getStyle=function(){return this._style};return a}();e.FileEditorMarker=F;var u=function(){function a(a,c,y,w,r){this._lastModified=a;this._undoState=c;this._position=y;this._originalText=r;this._savedText=
w;this._changeMade=!1}a.prototype.restoreUndoManager=function(a,c){var k=new B.ace.UndoManager;if(c==this._savedText&&this._undoState){var m=this._undoState.getUndoStack(),r=this._undoState.getRedoStack(),v;for(v in m)m.hasOwnProperty(v)&&(k.$undoStack[v]=m[v]);for(var e in r)r.hasOwnProperty(e)&&(k.$redoStack[e]=m[e]);k.$doc=a;k.dirtyCounter=this._undoState.getDirtyCounter()}a.setUndoManager(k)};a.prototype.restoreScrollPosition=function(a,c){if(this._position){var k=this._position.getScroll(),m=
this._position.getRow(),e=this._position.getColumn();0<=m&&0<=e?c.selection.moveTo(m,e):c.gotoLine(1);a.setScrollTop(k)}else c.gotoLine(1),a.setScrollTop(0);c.focus()};a.prototype.saveHistory=function(a){a.getSource();this._savedText=a.getSource();this._lastModified=a.getLastModified();this._undoState=a.getUndoState();this._position=a.getPosition()};a.prototype.updateHistory=function(a,c){a!=this._savedText&&(this._position=this._undoState=null);this._savedText=a;this._originalText=c;this._changeMade=
!1};a.prototype.invalidateHistory=function(){this._changeMade=!1;this._undoState=null;this._lastModified=-1;this._savedText=this._originalText=null};a.prototype.touchHistory=function(a){a!=this._savedText&&(this._lastModified=c.Common.currentTime());this._savedText=a};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getOriginalText=function(){return this._originalText};a.prototype.getSavedText=function(){return this._savedText};return a}();e.FileEditorHistory=u;var L=
function(){function a(a,c,e){this._undoStack=a;this._redoStack=c;this._dirtyCounter=e}a.prototype.getUndoStack=function(){return this._undoStack};a.prototype.getRedoStack=function(){return this._redoStack};a.prototype.getDirtyCounter=function(){return this._dirtyCounter};return a}();e.FileEditorUndoState=L;var M=function(){function a(a,c,e,w,r,v,x){this._lastModified=a;this._breakpoints=c;this._resource=e;this._undoState=w;this._isReadOnly=x;this._position=r;this._source=v}a.prototype.isStateValid=
function(){return this._resource&&null!=this._source&&""!=this._source};a.prototype.isReadOnly=function(){return this._isReadOnly};a.prototype.getResource=function(){return this._resource};a.prototype.getPosition=function(){return this._position};a.prototype.getUndoState=function(){return this._undoState};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getBreakpoints=function(){return this._breakpoints};a.prototype.getSource=function(){return this._source};return a}();
e.FileEditorState=M;var G=function(){function a(a,c,e){this._row=a;this._column=c;this._scroll=e}a.prototype.getRow=function(){return this._row};a.prototype.getColumn=function(){return this._column};a.prototype.getScroll=function(){return this._scroll};return a}();e.FileEditorPosition=G;var H=function(){function a(a,c,e,w){this._lastModified=a;this._isCurrent=w;this._resource=c;this._source=e}a.prototype.isBufferValid=function(){return this._resource&&null!=this._source};a.prototype.isBufferCurrent=
function(){return this._isCurrent};a.prototype.getResource=function(){return this._resource};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getSource=function(){return this._source};return a}();e.FileEditorBuffer=H;var z;(function(a){function e(){var b=d.getEditorPanel().getSession(),a=d.getEditorMarkers();d.getEditorResource();for(var f in a)if(a.hasOwnProperty(f)){var c=a[f];null!=c&&(b.removeMarker(c.getMarker()),delete a[f])}}function m(){var b=d.getEditorBreakpoints(),
a=[],f=1,c;for(c in b)if(b.hasOwnProperty(c)){var e=b[c],g;for(g in e)if(e.hasOwnProperty(g)&&1==e[g]){var l=A.FileTree.createResourcePath(c),n="\x3cdiv class\x3d'breakpointEnabled'\x3e"+l.getProjectPath()+"\x3c/div\x3e";a.push({recid:f++,name:n,location:"Line "+g,resource:l.getProjectPath(),line:parseInt(g),script:l.getResourcePath()})}}J.w2ui.breakpoints.records=a;J.w2ui.breakpoints.refresh();E.Command.updateScriptBreakpoints()}function y(){var b;b=d.getEditorPanel().getSession().getUndoManager();
var a=x.extend(!0,{},b.$undoStack),f=x.extend(!0,{},b.$redoStack);b=new L(a,f,b.dirtyCounter);a=d.getEditorPanel().getSession().getScrollTop();a=(f=d.getEditorPanel().selection.getCursor())?new G(f.row,f.column,a):new G(null,null,a);var f=r(),c=-1,e=null;f&&(e=f.getSource(),c=f.getLastModified());return new M(c,d.getEditorBreakpoints(),d.getEditorResource(),b,a,e,d.isEditorReadOnly())}function w(b){b=b.toLowerCase();if(c.Common.stringEndsWith(b,".tern"))return"ace/mode/tern";if(c.Common.stringEndsWith(b,
".policy"))return"ace/mode/policy";if(c.Common.stringEndsWith(b,".xml"))return"ace/mode/xml";if(c.Common.stringEndsWith(b,".json"))return"ace/mode/json";if(c.Common.stringEndsWith(b,".sql"))return"ace/mode/sql";if(c.Common.stringEndsWith(b,".pl"))return"ace/mode/perl";if(c.Common.stringEndsWith(b,".kt"))return"ace/mode/kotlin";if(c.Common.stringEndsWith(b,".js"))return"ace/mode/javascript";if(c.Common.stringEndsWith(b,".ts"))return"ace/mode/typescript";if(c.Common.stringEndsWith(b,".java"))return"ace/mode/java";
if(c.Common.stringEndsWith(b,".groovy"))return"ace/mode/groovy";if(c.Common.stringEndsWith(b,".py"))return"ace/mode/python";if(c.Common.stringEndsWith(b,".html")||c.Common.stringEndsWith(b,".htm"))return"ace/mode/html";if(c.Common.stringEndsWith(b,".txt"))return"ace/mode/text";if(c.Common.stringEndsWith(b,".properties"))return"ace/mode/properties";if(c.Common.stringEndsWith(b,".gitignore"))return"ace/mode/text";if(c.Common.stringEndsWith(b,".project"))return"ace/mode/xml";c.Common.stringEndsWith(b,
".classpath");return"ace/mode/text"}function r(){if(d.getEditorResource()){var b=d.getEditorResource().getResourcePath();return v(b)}return null}function v(b){b=A.FileTree.createResourcePath(b);var a=d.getHistoryForResource(b),c=a.getLastModified();return N(b.getResourcePath())?(a=d.getEditorPanel().getValue(),new H(c,b,a,!0)):new H(c,b,a.getSavedText(),!1)}function z(b){d.getEditorPanel().setReadOnly(b)}function u(){return d.getEditorPanel().getSelectionRange().start.row}function O(){if(null!=d.getEditorResource()){var b=
d.getHistoryForResource(d.getEditorResource()),a=d.getEditorPanel().getValue(),b=b.getOriginalText();return a!=b}return!1}function P(b){if(N(b))return O();b=A.FileTree.createResourcePath(b);var a=d.getHistoryForResource(b);b=a.getOriginalText();a=a.getSavedText();return b!=a}function N(a){return null!=d.getEditorResource()&&d.getEditorResource().getResourcePath()==a?!0:!1}function Q(){var a=d.getEditorPanel().getSession();d.getHistoryForResource(d.getEditorResource()).restoreScrollPosition(a,d.getEditorPanel())}
function I(a){C.Project.markEditorTab(a,P(a))}function R(){return{getCompletions:function(a,h,f,e,q){h=a.getValue();var b=a.session.getLine(f.row);a=d.getEditorResource().getProjectPath();b=b.substring(0,f.column);f=JSON.stringify({resource:a,line:f.row+1,complete:b,source:h,prefix:e});x.ajax({contentType:"application/json",data:f,dataType:"json",success:function(a){var b=a.expression;if(b){var d=Math.max(0,b.lastIndexOf(".")+1);a=a.tokens;var f=[],h;for(h in a)if(a.hasOwnProperty(h)){var e=a[h];
c.Common.stringStartsWith(h,b)&&(h=h.substring(d));f.push({className:"autocomplete_"+e,token:h,value:h,score:300,meta:e})}q(null,f)}},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+c.Common.getProjectName()})}}}function D(){var a=B.ace.edit("editor"),c=R();a.completers=[c];a.getSession().setMode("ace/mode/tern");a.getSession().setTabSize(3);a.setReadOnly(!1);a.setAutoScrollEditorIntoView(!0);a.getSession().setUseSoftTabs(!0);a.commands.removeCommand("replace");
a.commands.removeCommand("find");a.commands.removeCommand("expandToMatching");a.commands.removeCommand("expandtoline");a.setShowPrintMargin(!1);a.setOptions({enableBasicAutocompletion:!0});a.on("click",function(b){b=a.getOptions();console.log("Focus editor on click: options\x3d["+typeof b+"] -\x3e ",b);a.focus();b=Object.assign({readOnly:!1},b);console.log("Options after click: ",b);a.setOptions(b)});a.on("guttermousedown",function(b){var c=b.domEvent.target;if(-1!=c.className.indexOf("ace_gutter-cell")&&
a.isFocused()&&!(b.clientX>25+c.getBoundingClientRect().left)){var h=b.getDocumentPosition().row,c=d.getEditorBreakpoints();if(null!=d.getEditorResource()){var f=d.getEditorPanel().getSession(),e=c[d.getEditorResource().getFilePath()],n=f.getBreakpoints(),k=!1,p;for(p in n)if(p==h){k=!0;break}k?f.clearBreakpoint(h):f.setBreakpoint(h);p=parseInt(h);null==e?(e={},e[p+1]=!0,c[d.getEditorResource().getFilePath()]=e):e[p+1]=1==e[p+1]?!1:!0}m();b.stop()}});"undefined"!==typeof java&&a.setScrollSpeed(.05);
return new K(a)}var d=null;a.createEditor=function(){d=D();d.activateEditor();S.EventBus.createTermination(e)};a.clearEditorHighlights=e;a.showEditorLine=function(a){d.getEditorPanel();d.getEditorPanel().resize(!0);if(1<a){var b=a-1;u()!=b&&(d.getEditorPanel().scrollToLine(b,!0,!0,function(){}),d.getEditorPanel().gotoLine(a),d.getEditorPanel().focus())}else d.getEditorPanel().scrollToLine(0,!0,!0,function(){}),d.getEditorPanel().focus()};a.createEditorHighlight=function(a,c){var b=B.ace.require("ace/range").Range,
h=d.getEditorPanel().getSession(),q=d.getEditorMarkers(),g=q[a];e();b=h.addMarker(new b(a-1,0,a-1,1),c,"fullLine");b=new F(a,c,b);q[a]=b;return g?g.getStyle()!=c:!1};a.createMultipleEditorHighlights=function(a,c){for(var b=B.ace.require("ace/range").Range,h=d.getEditorPanel().getSession(),q=d.getEditorMarkers(),g=!1,l=0;l<a.length;l++){var n=a[l];(n=q[n])?n.getStyle()!=c&&(g=!0):g=!0}e();for(l=0;l<a.length;l++){var n=a[l],m=h.addMarker(new b(n-1,0,n-1,1),c,"fullLine"),m=new F(n,c,m);q[n]=m}return g};
a.findAndReplaceTextInEditor=function(){var a=y().getResource();E.Command.searchAndReplaceFiles(a.getProjectPath())};a.findTextInEditor=function(){var a=y().getResource();E.Command.searchFiles(a.getProjectPath())};a.addEditorKeyBinding=function(a,c){d.getEditorPanel().commands.addCommand({name:a.editor,bindKey:{win:a.editor,mac:a.editor},exec:function(a){c&&c()}})};a.showEditorBreakpoints=m;a.resizeEditor=function(){var a=document.getElementById("editor").offsetWidth,c=document.getElementById("editor").offsetHeight;
console.log("Resize editor "+a+"x"+c);d.getEditorPanel().setAutoScrollEditorIntoView(!0);d.getEditorPanel().resize(!0)};a.currentEditorState=y;a.resolveEditorMode=w;a.clearSavedEditorBuffer=function(a){var b=A.FileTree.createResourcePath(a);d.getHistoryForResource(b).invalidateHistory();I(a)};a.currrentEditorBuffer=r;a.getEditorBufferForResource=v;a.updateEditor=function(b){var c=b.getResourcePath(),f=b.isHistorical()||b.isError(),t=b.getFileContent(),q;q=b.getFileContent();var g=b.isHistorical()||
b.isError();console.log("resource\x3d["+b.getResourcePath().getResourcePath()+"] modified\x3d["+b.getTimeStamp()+"] length\x3d["+b.getFileLength()+"] readonly\x3d["+g+"]");g?console.log("IGNORE HISTORY WHEN READ ONLY"):(g=v(b.getResourcePath().getResourcePath()),g.getSource()&&g.getLastModified()>b.getLastModified()?(console.log("LOAD FROM HISTORY diff\x3d["+(g.getLastModified()-b.getLastModified())+"]"),q=g.getSource()):console.log("IGNORE HISTORY: ",g));b=d.getEditorPanel().getSession();var g=b.getMode(),
l=w(c.getResourcePath()),n=y();if(!n.isReadOnly()){var k=n.getResource(),k=d.getHistoryForResource(k);n.isStateValid()?k.saveHistory(n):k.invalidateHistory()}l!=g&&b.setMode({path:l,v:Date.now()});f?(t=q,d.getEditorPanel().setReadOnly(!1),d.getEditorPanel().setValue(t,1)):(g=d.getHistoryForResource(c),d.getEditorPanel().setReadOnly(!1),d.getEditorPanel().setValue(q,1),g.updateHistory(q,t),g.restoreUndoManager(b,q));var t=d.getEditorPanel().getSession(),p;for(p in t.$backMarkers)t.removeMarker(p);
e();p=t.getBreakpoints();for(var r in p)t.clearBreakpoint(r);x("#currentFile").html("");z(f);d.updateResourcePath(c,f);T.ProblemManager.highlightProblems();if(null!=c&&d.getEditorResource()&&(c=d.getEditorResource().getFilePath(),c=d.getEditorBreakpoints()[c],null!=c))for(var u in c)c.hasOwnProperty(u)&&1==c[u]&&(t=parseInt(u)-1,f=d.getEditorBreakpoints(),null!=d.getEditorResource()&&(r=d.getEditorPanel().getSession(),p=f[d.getEditorResource().getFilePath()],t=parseInt(t),r.setBreakpoint(t),null==
p&&(p={},f[d.getEditorResource().getFilePath()]=p),p[t+1]=!0),m());C.Project.createEditorTab();U.History.showFileHistory();V.StatusPanel.showActiveFile(d.getEditorResource().getProjectPath());a.showEditorFileInTree();Q();I(d.getEditorResource().getResourcePath())};a.focusEditor=function(){d.getEditorPanel().focus();d.getEditorPanel().setReadOnly(!1)};a.setReadOnly=z;a.showEditorFileInTree=function(){var a=y().getResource();A.FileTree.showTreeNode("explorerTree",a)};a.getCurrentLineForEditor=u;a.getSelectedText=
function(){return d.getEditorPanel().getSelectedText()};a.isEditorChanged=O;a.isEditorChangedForPath=P;a.scrollEditorToPosition=Q;a.updateProjectTabOnChange=function(){d.getEditorPanel().on("input",function(){var a=d.getEditorResource(),a=d.getHistoryForResource(a),c=d.getEditorPanel().getValue();a.touchHistory(c);I(d.getEditorResource().getResourcePath())})};a.formatEditorSource=function(){var a=d.getEditorPanel().getValue(),e=d.getEditorResource().getFilePath();x.ajax({contentType:"text/plain",
data:a,success:function(a){d.getEditorPanel().setReadOnly(!1);d.getEditorPanel().setValue(a,1)},error:function(){console.log("Format failed")},processData:!1,type:"POST",url:"/format/"+c.Common.getProjectName()+e})};a.setEditorTheme=function(a){null!=a&&null!=d.getEditorPanel()&&d.getEditorPanel().setTheme(a)};a.updateEditorFont=function(a,e){var b=R(),h;h=a.split(",");for(var k="",g=0;g<h.length;g++)var l=h[g],l=c.Common.stringReplaceText(l,"'",""),l=c.Common.stringReplaceText(l,'"',""),l="'"+l.trim()+
"'",k=k+(l+",");h=k+"monospace";d.getEditorPanel().completers=[b];d.getEditorPanel().setOptions({enableBasicAutocompletion:!0,fontFamily:h,fontSize:e})}})(z=e.FileEditor||(e.FileEditor={}))});
