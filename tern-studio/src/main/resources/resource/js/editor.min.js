define("require exports jquery ace w2ui common socket problem tree history project status keys commands".split(" "),function(P,h,t,p,B,e,J,K,n,L,u,M,N,q){var E=function(){function a(b){this._editorBreakpointManager=new C(this);this._editorHighlightManager=new D(this);this._editorPanel=b;this._editorHistory={};this._editorMarkers={};this._editorBreakpoints={}}a.prototype.activateEditor=function(){N.KeyBinder.bindKeys();u.Project.changeProjectFont();v.scrollEditorToPosition();v.updateProjectTabOnChange()};
a.prototype.updateResourcePath=function(b,a){window.location.hash=b.getProjectPath();this._editorResource=b;this._editorReadOnly=a};a.prototype.getHistoryForResource=function(b){if(b){b=b.getResourcePath();var a=this._editorHistory[b];a||(a=this._editorHistory[b]=new w(-1,null,null,null,null));return a}return new w(-1,null,null,null,null)};a.prototype.getEditorBreakpointManager=function(){return this._editorBreakpointManager};a.prototype.getEditorHighlightManager=function(){return this._editorHighlightManager};
a.prototype.getEditorResource=function(){return this._editorResource};a.prototype.isEditorReadOnly=function(){return this._editorReadOnly};a.prototype.getEditorPanel=function(){return this._editorPanel};a.prototype.getEditorMarkers=function(){return this._editorMarkers};a.prototype.getEditorBreakpoints=function(){return this._editorBreakpoints};return a}();h.FileEditorView=E;var C=function(){function a(b){this._editorView=b}a.prototype.getEditorView=function(){return this._editorView};a.prototype.clearEditorBreakpoint=
function(b){var a=this.getEditorView().getEditorPanel().getSession(),d=a.getBreakpoints();b=parseInt(b);for(var l in d)if(d.hasOwnProperty(l)){var f=parseInt(l);f==b&&a.clearBreakpoint(f)}this.showEditorBreakpoints()};a.prototype.clearEditorBreakpoints=function(){var b=this.getEditorView().getEditorPanel().getSession(),a=b.getBreakpoints(),d;for(d in a)a.hasOwnProperty(d)&&b.clearBreakpoint(d)};a.prototype.showEditorBreakpoints=function(){var b=this.getEditorView().getEditorBreakpoints(),a=[],d=1,
l;for(l in b)if(b.hasOwnProperty(l)){var f=b[l],k;for(k in f)if(f.hasOwnProperty(k)&&1==f[k]){var x=n.FileTree.createResourcePath(l),e="\x3cdiv class\x3d'breakpointEnabled'\x3e"+x.getProjectPath()+"\x3c/div\x3e";a.push({recid:d++,name:e,location:"Line "+k,resource:x.getProjectPath(),line:parseInt(k),script:x.getResourcePath()})}}B.w2ui.breakpoints.records=a;B.w2ui.breakpoints.refresh();q.Command.updateScriptBreakpoints()};a.prototype.setEditorBreakpoint=function(a,c){var b=this.getEditorView().getEditorBreakpoints(),
l=parseInt(a);if(null!=this.getEditorView().getEditorResource()){var f=this.getEditorView().getEditorPanel().getSession(),k=b[this.getEditorView().getEditorResource().getFilePath()];c?f.setBreakpoint(l):f.clearBreakpoint(l);null==k&&(k={},b[this.getEditorView().getEditorResource().getFilePath()]=k);k[l+1]=c}this.showEditorBreakpoints()};a.prototype.toggleEditorBreakpoint=function(a){var b=this.getEditorView().getEditorBreakpoints();if(null!=this.getEditorView().getEditorResource()){var d=this.getEditorView().getEditorPanel().getSession(),
l=d.getBreakpoints(),f=b[this.getEditorView().getEditorResource().getFilePath()],k=!1,e;for(e in l)if(e==a){k=!0;break}k?d.clearBreakpoint(a):d.setBreakpoint(a);a=parseInt(a);null==f?(f={},f[a+1]=!0,b[this.getEditorView().getEditorResource().getFilePath()]=f):f[a+1]=1==f[a+1]?!1:!0}this.showEditorBreakpoints()};a.prototype.restoreResourceBreakpoints=function(){var a=this.getEditorView();if(a.getEditorResource()){var c=a.getEditorResource().getFilePath(),a=a.getEditorBreakpoints()[c];if(null!=a)for(var d in a)a.hasOwnProperty(d)&&
1==a[d]&&this.setEditorBreakpoint(parseInt(d)-1,!0)}};return a}();h.FileEditorBreakpointManager=C;var D=function(){function a(a){this._editorView=a}a.prototype.getEditorView=function(){return this._editorView};a.prototype.clearEditorHighlights=function(){var a=this.getEditorView().getEditorPanel().getSession(),c=this.getEditorView().getEditorMarkers();this.getEditorView().getEditorResource();for(var d in c)if(c.hasOwnProperty(d)){var l=c[d];null!=l&&(a.removeMarker(l.getMarker()),delete c[d])}};a.prototype.showEditorLine=
function(a){this.getEditorView().getEditorPanel();this.getEditorView().getEditorPanel().resize(!0);if(1<a){var b=a-1;this.getCurrentLineForEditor()!=b&&(this.getEditorView().getEditorPanel().scrollToLine(b,!0,!0,function(){}),this.getEditorView().getEditorPanel().gotoLine(a),this.getEditorView().getEditorPanel().focus())}else this.getEditorView().getEditorPanel().scrollToLine(0,!0,!0,function(){}),this.getEditorView().getEditorPanel().focus()};a.prototype.clearEditorHighlight=function(a){var b=this.getEditorView().getEditorPanel().getSession();
a=this.getEditorView().getEditorMarkers()[a];null!=a&&b.removeMarker(a.getMarker())};a.prototype.createEditorHighlight=function(a,c){var b=p.ace.require("ace/range").Range,l=this.getEditorView().getEditorPanel().getSession(),f=this.getEditorView().getEditorMarkers(),k=f[a];this.clearEditorHighlights();b=l.addMarker(new b(a-1,0,a-1,1),c,"fullLine");b=new y(a,c,b);f[a]=b;return k?k.getStyle()!=c:!1};a.prototype.createMultipleEditorHighlights=function(a,c){for(var b=p.ace.require("ace/range").Range,
l=this.getEditorView().getEditorPanel().getSession(),f=this.getEditorView().getEditorMarkers(),k=!1,e=0;e<a.length;e++){var h=a[e];(h=f[h])?h.getStyle()!=c&&(k=!0):k=!0}this.clearEditorHighlights();for(e=0;e<a.length;e++){var h=a[e],r=l.addMarker(new b(h-1,0,h-1,1),c,"fullLine"),r=new y(h,c,r);f[h]=r}return k};a.prototype.getCurrentLineForEditor=function(){return this.getEditorView().getEditorPanel().getSelectionRange().start.row};return a}();h.FileEditorHighlightManager=D;var y=function(){function a(a,
c,d){this._style=c;this._line=a;this._marker=d}a.prototype.getLine=function(){return this._line};a.prototype.getMarker=function(){return this._marker};a.prototype.getStyle=function(){return this._style};return a}();h.FileEditorMarker=y;var w=function(){function a(a,c,d,l,f){this._lastModified=a;this._undoState=c;this._position=d;this._originalText=f;this._savedText=l;this._changeMade=!1}a.prototype.restoreUndoManager=function(a,c){var b=new p.ace.UndoManager;if(c==this._savedText&&this._undoState){var l=
this._undoState.getUndoStack(),f=this._undoState.getRedoStack(),k;for(k in l)l.hasOwnProperty(k)&&(b.$undoStack[k]=l[k]);for(var e in f)f.hasOwnProperty(e)&&(b.$redoStack[e]=l[e]);b.$doc=a;b.dirtyCounter=this._undoState.getDirtyCounter()}a.setUndoManager(b)};a.prototype.restoreScrollPosition=function(a,c){if(this._position){var b=this._position.getScroll(),l=this._position.getRow(),f=this._position.getColumn();0<=l&&0<=f?c.selection.moveTo(l,f):c.gotoLine(1);a.setScrollTop(b)}else c.gotoLine(1),a.setScrollTop(0);
c.focus()};a.prototype.saveHistory=function(a){a.getSource();this._savedText=a.getSource();this._lastModified=a.getLastModified();this._undoState=a.getUndoState();this._position=a.getPosition()};a.prototype.updateHistory=function(a,c){a!=this._savedText&&(this._position=this._undoState=null);this._savedText=a;this._originalText=c;this._changeMade=!1};a.prototype.invalidateHistory=function(){this._changeMade=!1;this._undoState=null;this._lastModified=-1;this._savedText=this._originalText=null};a.prototype.touchHistory=
function(a){a!=this._savedText&&(this._lastModified=e.Common.currentTime());this._savedText=a};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getOriginalText=function(){return this._originalText};a.prototype.getSavedText=function(){return this._savedText};return a}();h.FileEditorHistory=w;var F=function(){function a(a,c,d){this._undoStack=a;this._redoStack=c;this._dirtyCounter=d}a.prototype.getUndoStack=function(){return this._undoStack};a.prototype.getRedoStack=function(){return this._redoStack};
a.prototype.getDirtyCounter=function(){return this._dirtyCounter};return a}();h.FileEditorUndoState=F;var G=function(){function a(a,c,d,l,f,e,h){this._lastModified=a;this._breakpoints=c;this._resource=d;this._undoState=l;this._isReadOnly=h;this._position=f;this._source=e}a.prototype.isStateValid=function(){return this._resource&&null!=this._source&&""!=this._source};a.prototype.isReadOnly=function(){return this._isReadOnly};a.prototype.getResource=function(){return this._resource};a.prototype.getPosition=
function(){return this._position};a.prototype.getUndoState=function(){return this._undoState};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getBreakpoints=function(){return this._breakpoints};a.prototype.getSource=function(){return this._source};return a}();h.FileEditorState=G;var z=function(){function a(a,c,d){this._row=a;this._column=c;this._scroll=d}a.prototype.getRow=function(){return this._row};a.prototype.getColumn=function(){return this._column};a.prototype.getScroll=
function(){return this._scroll};return a}();h.FileEditorPosition=z;var A=function(){function a(a,c,d,l){this._lastModified=a;this._isCurrent=l;this._resource=c;this._source=d}a.prototype.isBufferValid=function(){return this._resource&&null!=this._source};a.prototype.isBufferCurrent=function(){return this._isCurrent};a.prototype.getResource=function(){return this._resource};a.prototype.getLastModified=function(){return this._lastModified};a.prototype.getSource=function(){return this._source};return a}();
h.FileEditorBuffer=A;var O=function(){function a(a,c,d,l,f,e){this._editorView=a;this._resourcePath=c;this._editorMode=d;this._editorText=l;this._isReadOnly=f;this._lastModified=e}a.prototype.isReadOnly=function(){return this._isReadOnly};a.prototype.getEditorView=function(){return this._editorView};a.prototype.getResourcePath=function(){return this._resourcePath};a.prototype.getEditorMode=function(){return this._editorMode};a.prototype.getEditorText=function(){return this._editorText};a.prototype.getLastModified=
function(){return this._lastModified};return a}(),H;(function(a){function b(a){return{getCompletions:function(b,c,f,k,h){c=b.getValue();var d=b.session.getLine(f.row);b=a.getEditorResource().getProjectPath();d=d.substring(0,f.column);f=JSON.stringify({resource:b,line:f.row+1,complete:d,source:c,prefix:k});t.ajax({contentType:"application/json",data:f,dataType:"json",success:function(a){var b=a.expression;if(b){var m=Math.max(0,b.lastIndexOf(".")+1);a=a.tokens;var d=[],c;for(c in a)if(a.hasOwnProperty(c)){var f=
a[c];e.Common.stringStartsWith(c,b)&&(c=c.substring(m));d.push({className:"autocomplete_"+f,token:c,value:c,score:300,meta:f})}h(null,d)}},error:function(){console.log("Completion control failed")},processData:!1,type:"POST",url:"/complete/"+e.Common.getProjectName()})}}}a.createFileEditorView=function(a){var d=p.ace.edit(a),c=new E(d);a=b(c);d.completers=[a];d.getSession().setMode("ace/mode/tern");d.getSession().setTabSize(3);d.setReadOnly(!1);d.setAutoScrollEditorIntoView(!0);d.getSession().setUseSoftTabs(!0);
d.commands.removeCommand("replace");d.commands.removeCommand("find");d.commands.removeCommand("expandToMatching");d.commands.removeCommand("expandtoline");d.setShowPrintMargin(!1);d.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0});d.on("guttermousedown",function(a){var b=a.domEvent.target;-1==b.className.indexOf("ace_gutter-cell")||!d.isFocused()||a.clientX>25+b.getBoundingClientRect().left||(b=a.getDocumentPosition().row,c.getEditorBreakpointManager().toggleEditorBreakpoint(b),
a.stop())});"undefined"!==typeof java&&d.setScrollSpeed(.05);return c}})(H=h.FileEditorBuilder||(h.FileEditorBuilder={}));var I;(function(a){a.resolveEditorMode=function(a){a=a.toLowerCase();if(e.Common.stringEndsWith(a,".tern"))return"ace/mode/tern";if(e.Common.stringEndsWith(a,".policy"))return"ace/mode/policy";if(e.Common.stringEndsWith(a,".xml"))return"ace/mode/xml";if(e.Common.stringEndsWith(a,".json"))return"ace/mode/json";if(e.Common.stringEndsWith(a,".sql"))return"ace/mode/sql";if(e.Common.stringEndsWith(a,
".pl"))return"ace/mode/perl";if(e.Common.stringEndsWith(a,".kt"))return"ace/mode/kotlin";if(e.Common.stringEndsWith(a,".js"))return"ace/mode/javascript";if(e.Common.stringEndsWith(a,".ts"))return"ace/mode/typescript";if(e.Common.stringEndsWith(a,".java"))return"ace/mode/java";if(e.Common.stringEndsWith(a,".groovy"))return"ace/mode/groovy";if(e.Common.stringEndsWith(a,".py"))return"ace/mode/python";if(e.Common.stringEndsWith(a,".html")||e.Common.stringEndsWith(a,".htm"))return"ace/mode/html";if(e.Common.stringEndsWith(a,
".txt"))return"ace/mode/text";if(e.Common.stringEndsWith(a,".properties"))return"ace/mode/properties";if(e.Common.stringEndsWith(a,".gitignore"))return"ace/mode/text";if(e.Common.stringEndsWith(a,".project"))return"ace/mode/xml";e.Common.stringEndsWith(a,".classpath");return"ace/mode/text"}})(I=h.FileEditorModeMapper||(h.FileEditorModeMapper={}));var v;(function(a){function b(){var a;a=g.getEditorPanel().getSession().getUndoManager();var b=t.extend(!0,{},a.$undoStack),d=t.extend(!0,{},a.$redoStack);
a=new F(b,d,a.dirtyCounter);b=g.getEditorPanel().getSession().getScrollTop();b=(d=g.getEditorPanel().selection.getCursor())?new z(d.row,d.column,b):new z(null,null,b);var d=c(),f=-1,e=null;d&&(e=d.getSource(),f=d.getLastModified());return new G(f,g.getEditorBreakpoints(),g.getEditorResource(),a,b,e,g.isEditorReadOnly())}function c(){if(g.getEditorResource()){var a=g.getEditorResource().getResourcePath();return d(a)}return null}function d(a){a=n.FileTree.createResourcePath(a);var b=g.getHistoryForResource(a),
d=b.getLastModified(),m=a.getResourcePath();return h(m)?(b=g.getEditorPanel().getValue(),new A(d,a,b,!0)):new A(d,a,b.getSavedText(),!1)}function l(a){g.getEditorPanel().setReadOnly(a)}function f(){if(null!=g.getEditorResource()){var a=g.getHistoryForResource(g.getEditorResource()),b=g.getEditorPanel().getValue(),a=a.getOriginalText();return b!=a}return!1}function k(a){if(h(a))return f();a=n.FileTree.createResourcePath(a);var b=g.getHistoryForResource(a);a=b.getOriginalText();b=b.getSavedText();return a!=
b}function h(a){return null!=g.getEditorResource()&&g.getEditorResource().getResourcePath()==a?!0:!1}function p(){var a=g.getEditorPanel().getSession();g.getHistoryForResource(g.getEditorResource()).restoreScrollPosition(a,g.getEditorPanel())}function r(a){u.Project.markEditorTab(a,k(a))}var g=null;a.createEditor=function(){g=H.createFileEditorView("editor");g.activateEditor();J.EventBus.createTermination(function(){g.getEditorHighlightManager().clearEditorHighlights()})};a.clearEditorHighlights=
function(){g.getEditorHighlightManager().clearEditorHighlights()};a.showEditorLine=function(a){g.getEditorHighlightManager().showEditorLine(a)};a.clearEditorHighlight=function(a){g.getEditorHighlightManager().clearEditorHighlight(a)};a.createEditorHighlight=function(a,b){return g.getEditorHighlightManager().createEditorHighlight(a,b)};a.createMultipleEditorHighlights=function(a,b){return g.getEditorHighlightManager().createMultipleEditorHighlights(a,b)};a.findAndReplaceTextInEditor=function(){var a=
b().getResource();q.Command.searchAndReplaceFiles(a.getProjectPath())};a.findTextInEditor=function(){var a=b().getResource();q.Command.searchFiles(a.getProjectPath())};a.addEditorKeyBinding=function(a,b){g.getEditorPanel().commands.addCommand({name:a.editor,bindKey:{win:a.editor,mac:a.editor},exec:function(a){b&&b()}})};a.resizeEditor=function(){var a=document.getElementById("editor").offsetWidth,b=document.getElementById("editor").offsetHeight;console.log("Resize editor "+a+"x"+b);g.getEditorPanel().setAutoScrollEditorIntoView(!0);
g.getEditorPanel().resize(!0)};a.currentEditorState=b;a.clearSavedEditorBuffer=function(a){var b=n.FileTree.createResourcePath(a);g.getHistoryForResource(b).invalidateHistory();r(a)};a.currrentEditorBuffer=c;a.getEditorBufferForResource=d;a.updateEditor=function(c){var f;f=c.getFileContent();if(!c.isHistorical()&&!c.isError()){var e=c.getResourcePath().getResourcePath(),h=c.getLastModified(),k=d(e),e=k.getSource(),k=k.getLastModified();e&&k>=h&&(f=e)}var h=c.getResourcePath(),k=h.getResourcePath(),
e=c.isHistorical()||c.isError(),k=I.resolveEditorMode(k),m=c.getLastModified();f=new O(g,h,k,f,e,m);h=b();h.isReadOnly()||(e=h.getResource(),e=g.getHistoryForResource(e),h.isStateValid()?e.saveHistory(h):e.invalidateHistory());var h=g.getEditorPanel().getSession(),e=h.getMode(),k=c.getFileContent(),n=f.getEditorMode(),m=f.getEditorText();c=f.isReadOnly();f=f.getResourcePath();n!=e&&h.setMode({path:n,v:Date.now()});c?(g.getEditorPanel().setReadOnly(!1),g.getEditorPanel().setValue(m,1)):(e=g.getHistoryForResource(f),
g.getEditorPanel().setReadOnly(!1),g.getEditorPanel().setValue(m,1),e.updateHistory(m,k),e.restoreUndoManager(h,m));l(c);var h=g.getEditorPanel().getSession(),q;for(q in h.$backMarkers)h.removeMarker(q);g.getEditorHighlightManager().clearEditorHighlights();g.getEditorBreakpointManager().clearEditorBreakpoints();t("#currentFile").html("");g.updateResourcePath(f,c);K.ProblemManager.highlightProblems();g.getEditorBreakpointManager().restoreResourceBreakpoints();u.Project.createEditorTab();L.History.showFileHistory();
M.StatusPanel.showActiveFile(g.getEditorResource().getProjectPath());a.showEditorFileInTree();p();r(g.getEditorResource().getResourcePath())};a.sneakyUpdateEditor=function(a){g.getEditorPanel().setReadOnly(!1);g.getEditorPanel().setValue(a,1)};a.focusEditor=function(){g.getEditorPanel().focus();g.getEditorPanel().setReadOnly(!1)};a.setReadOnly=l;a.showEditorFileInTree=function(){var a=b().getResource();n.FileTree.showTreeNode("explorerTree",a)};a.getCurrentLineForEditor=function(){return g.getEditorPanel().getSelectionRange().start.row};
a.getSelectedText=function(){return g.getEditorPanel().getSelectedText()};a.isEditorChanged=f;a.isEditorChangedForPath=k;a.scrollEditorToPosition=p;a.updateProjectTabOnChange=function(){g.getEditorPanel().on("input",function(){var a=g.getEditorResource(),a=g.getHistoryForResource(a),b=g.getEditorPanel().getValue();a.touchHistory(b);r(g.getEditorResource().getResourcePath())})};a.formatEditorSource=function(){q.Command.formatEditorSource()};a.setEditorTheme=function(a){null!=a&&null!=g.getEditorPanel()&&
g.getEditorPanel().setTheme(a)};a.showEditorBreakpoints=function(){g.getEditorBreakpointManager().showEditorBreakpoints()};a.updateEditorFont=function(a,b){var c;c=a.split(",");for(var d="",f=0;f<c.length;f++)var h=c[f],h=e.Common.stringReplaceText(h,"'",""),h=e.Common.stringReplaceText(h,'"',""),h="'"+h.trim()+"'",d=d+(h+",");c=d+"monospace";g.getEditorPanel().setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,fontFamily:c,fontSize:b})}})(v=h.FileEditor||(h.FileEditor={}))});
